import{E as De}from"./exceljs-6b62d6db.js";import{F as Oe}from"./file-saver-38a5c18e.js";import{h as ye}from"./moment-fbc5633a.js";import{u as ne}from"./vue-i18n-3a91c5c4.js";import{E as le,a as Ie,b as pe,c as fe,d as xe,e as Tt,f as Mt,g as Se,h as Ke,i as Ne,j as ze,k as Xe,l as Et,m as Ce,n as Ft,o as Ze,p as Ve,q as qe,r as $e,s as Ut,t as Dt,u as Qe,v as Rt,w as At,x as Lt,y as It,z as Nt,A as zt,B as $t,C as Gt,D as Bt,F as Yt,G as Wt}from"./element-plus-96c47ee5.js";import{r as T,o as g,c as W,X as Q,b as et,u as e,O as N,I as E,ad as Te,J as t,a as $,S as l,P as k,Q as v,A as ue,R as K,ac as q,ak as tt,w as je,_ as lt,ar as Ot,as as jt}from"./@vue-2150b1fb.js";import{m as Ht}from"./js-md5-11f5a111.js";import{h as Me}from"./@vueuse-1138cc68.js";import{d as me,s as ee,g as he,a as He,l as Ae,b as Re,u as Jt,c as ce,e as ve,f as Le,r as Kt,_ as at,p as st,h as ot,i as Xt}from"./index-814bb075.js";import{u as Zt}from"./vue-router-67d91bd0.js";import{_ as qt}from"./backImg-a3b16eec.js";import{m as Qt,u as el,n as Je,o as tl,v as ll,h as al,r as sl}from"./@element-plus-82a6dcc3.js";import"./ali-oss-21f5c855.js";import"./@intlify-9ddbe450.js";import"./lodash-es-f5bdeb48.js";import"./async-validator-dee29e8b.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./escape-html-cf2a8097.js";import"./normalize-wheel-es-ed76fb12.js";import"./crypto-js-d55471a7.js";import"./vuex-406a410d.js";import"./cos-js-sdk-v5-31c61e27.js";const ol={__name:"ImportExport",emits:["importComplete"],setup(Z,{expose:b,emit:J}){const{t:P}=ne(),M=J,n=T(),_=T(),f=T(0),S=c=>{n.value.click(),_.value=c},V=async()=>{if(n.value.files===0)return;f.value=Date.now();const c=new De.Workbook;c.xlsx.load(n.value.files[0]).then(()=>{c.eachSheet(function(d){if(d.rowCount<2){le.error(P("importExport.data.empty")),n.value.value="";return}let s=[];for(let r=2;r<=d.rowCount;r++){let a=d.getRow(r),x=o(a.getCell(1).value),U=o(a.getCell(2).value),p=o(a.getCell(3).value),C=o(a.getCell(4).value),A=o(a.getCell(5).value),D=o(a.getCell(6).value),O=o(a.getCell(7).value),Y=o(a.getCell(8).value);x&&s.push({id:f.value++,name:x,address:U,userName:p,password:C,remark:D,label:m(A),insertTime:O,updateTime:Y})}M("importComplete",s,_.value),n.value.value=""})}).catch(d=>{le.error(d),n.value.value=""})},o=c=>c?typeof c=="object"?c instanceof Date?ye(c).format("YYYY-MM-DD HH:mm:ss"):c.text:c.toString():"",m=c=>{if(!c)return"";let d=[],s=c.split("、");for(let r=0;r<s.length;r++){let a=h(_.value,s[r],"");if(a)d.push(a);else{let x=[];R(_.value,s[r].split(">"),0,x);for(let U=0;U<x.length;U++)d.push(x[U])}}return Array.from(new Set(d))},h=(c,d,s)=>{for(let r=0;r<c.length;r++){let a=s?s+">"+c[r].label:c[r].label;if(d===a)return c[r].id;if(c[r].children&&c[r].children.length>0)return h(c[r].children,d,a)}},R=(c,d,s,r)=>{if(!d[s])return;for(let x=0;x<c.length;x++)if(c[x].label===d[s])return d[s+1]||r.push(c[x].id),R(c[x].children,d,s+1,r);let a={id:f.value++,label:d[s],children:[]};c.push(a),d[s+1]||r.push(a.id),R(a.children,d,s+1,r)},I=async(c,d)=>{_.value=d;const s=new De.Workbook,r=s.addWorksheet("sheet1");r.getCell("A1").value=P("password.name"),r.getCell("B1").value=P("password.address"),r.getCell("C1").value=P("password.userName"),r.getCell("D1").value=P("password.password"),r.getCell("E1").value=P("password.label"),r.getCell("F1").value=P("password.remark"),r.getCell("G1").value=P("password.insertTime"),r.getCell("H1").value=P("password.updateTime");for(let a=0;a<c.length;a++){let x=c[a].insertTime;x||(x=ye().format("YYYY-MM-DD HH:mm:ss")),r.getCell("A"+(a+2)).value=c[a].name,r.getCell("B"+(a+2)).value=c[a].address,r.getCell("C"+(a+2)).value=c[a].userName,r.getCell("D"+(a+2)).value=c[a].password,r.getCell("E"+(a+2)).value=B(c[a].label),r.getCell("F"+(a+2)).value=c[a].remark,r.getCell("G"+(a+2)).value=x,r.getCell("H"+(a+2)).value=c[a].updateTime}s.xlsx.writeBuffer().then(a=>{let x=new Blob([a],{type:"application/octet-stream"});Oe.saveAs(x,P("importExport.exportName")+"_"+ye().format("YYYY-MM-DD HH:mm:ss")+".xlsx")})},B=c=>{if(!c)return"";let d=[];return G(_.value,c,d,""),d.join("、")},G=(c,d,s,r)=>{for(let a=0;a<c.length;a++){let x=r?r+">"+c[a].label:c[a].label;d.includes(c[a].id)&&s.push(x),c[a].children&&c[a].children.length>0&&G(c[a].children,d,s,x)}};return b({importExcel:S,exportExcel:I,downloadExcelTemplate:()=>{const c=new De.Workbook,d=c.addWorksheet("sheet1");d.getCell("A1").value=P("password.name"),d.getCell("B1").value=P("password.address"),d.getCell("C1").value=P("password.userName"),d.getCell("D1").value=P("password.password"),d.getCell("E1").value=P("password.label"),d.getCell("F1").value=P("password.remark"),d.getCell("G1").value=P("password.insertTime"),d.getCell("H1").value=P("password.updateTime"),c.xlsx.writeBuffer().then(s=>{let r=new Blob([s],{type:"application/octet-stream"});Oe.saveAs(r,P("importExport.importTemplateName")+".xlsx")})}}),(c,d)=>(g(),W("input",{type:"file",onChange:V,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ref_key:"fileUploadInput",ref:n,style:{display:"none"}},null,544))}},nl=["width","height"],Ge={__name:"GesturePassword",props:{size:{type:Number,default:300},count:{type:Number,default:3},showGesture:{type:Boolean,default:!0}},emits:["complete"],setup(Z,{expose:b,emit:J}){const P=Me(),M=J,n=T();let _=Z;const f=Q({padding:_.size*.18,background:P.value?"rgb(20,20,20)":"#fff",failColor:"#F56C6C",passColor:"#67C23A",point:{color:"#409EFF",size:_.size*.023,selected:{range:_.size*.07,color:"#409EFF",size:_.size*.023,madding:{color:"#409EFF",size:_.size*.07,lineWidth:1}}},line:{color:"#409EFF",width:2}}),S=T({}),V=T([]),o=T(!1),m=T("");let h=null;const R=()=>{f.background=P.value?"rgb(20,20,20)":"#fff",h=n.value.getContext("2d"),I()},I=()=>{h.fillStyle=f.background,h.fillRect(0,0,_.size,_.size),S.value=[];let p=(_.size-f.padding*2)/(_.count-1),C=1;for(let A=0;A<_.count;A++)for(let D=0;D<_.count;D++){let O=f.padding+D*p,Y=f.padding+A*p,F=p/2,X={id:C,x:O,y:Y,startX:O-F,endX:O+F,startY:Y-F,endY:Y+F,h:p,w:p};B(X),S.value[C]=X,C++}},B=p=>{let C=a(p);C&&_.showGesture&&(h.beginPath(),m.value==="fail"?h.strokeStyle=f.failColor:m.value==="pass"?h.strokeStyle=f.passColor:h.strokeStyle=f.point.selected.madding.color,h.lineWidth=f.point.selected.madding.lineWidth,h.arc(p.x,p.y,f.point.selected.madding.size,0,Math.PI*2),h.stroke()),h.beginPath(),C&&_.showGesture?(m.value==="fail"?h.fillStyle=f.failColor:m.value==="pass"?h.fillStyle=f.passColor:h.fillStyle=f.point.selected.madding.color,h.arc(p.x,p.y,f.point.selected.size,0,Math.PI*2)):(h.fillStyle=f.point.color,h.arc(p.x,p.y,f.point.size,0,Math.PI*2)),h.fill()},G=()=>{o.value=!0},y=()=>{if(!o.value)return;o.value=!1;let p=d();if(p){let C=Ht(p);M("complete",C)}I(),r()},c=p=>{m.value=p,I(),r(),p?setTimeout(()=>{m.value="",V.value=[],I()},500):(V.value=[],I())},d=()=>{let p="";for(let C=0;C<V.value.length;C++)p+=V.value[C].id+",";return p&&(p=p.substring(0,p.length-1)),p},s=p=>{let C=p.offsetX,A=p.offsetY;if(I(),r(C,A),!o.value)return;let D=x(C,A);!D||a(D)||(V.value.push(D),I(),r(C,A))},r=(p,C)=>{if(!_.showGesture)return;let A=x(p,C);if(A&&m.value===""&&(h.beginPath(),h.strokeStyle=f.point.selected.madding.color,h.lineWidth=f.point.selected.madding.lineWidth,h.arc(A.x,A.y,f.point.selected.madding.size,0,Math.PI*2),h.stroke()),V.value.length!==0){h.beginPath(),m.value==="fail"?h.strokeStyle=f.failColor:m.value==="pass"?h.strokeStyle=f.passColor:h.strokeStyle=f.line.color,h.lineWidth=f.line.width,h.lineCap="round",h.moveTo(V.value[0].x,V.value[0].y);for(let D=1;D<V.value.length;D++)h.lineTo(V.value[D].x,V.value[D].y);o.value&&p&&C&&m.value===""&&h.lineTo(p,C),h.stroke()}},a=p=>{for(let C=0;C<V.value.length;C++)if(p.id===V.value[C].id)return!0;return!1},x=(p,C)=>{for(let A in S.value){let D=S.value[A];if(p>D.startX+f.point.selected.range&&p<D.endX-f.point.selected.range&&C>D.startY+f.point.selected.range&&C<D.endY-f.point.selected.range)return D}},U=p=>{let C=p.touches[0].clientX-n.value.offsetLeft,A=p.touches[0].clientY-n.value.offsetTop;s({offsetX:C,offsetY:A})};return et(()=>{R()}),b({setVerifyStatus:c}),(p,C)=>e(_).size?(g(),W("canvas",{key:0,width:e(_).size,height:e(_).size,ref_key:"canvasRef",ref:n,onMousedown:G,onMouseup:y,onMousemove:C[0]||(C[0]=A=>s(A)),onMouseleave:y,onTouchstart:G,onTouchend:y,onTouchmove:U},null,40,nl)):N("",!0)}},rl={style:{"text-align":"center"}},dl={class:"dialog-footer"},il={__name:"DeleteAccount",emits:["deleteAccount"],setup(Z,{expose:b,emit:J}){const{t:P}=ne(),M=J,n=T(),_=Q({deleteAccount:!1}),f=T(""),S=T(""),V=()=>{let R=me(S.value,ee.state.verifyCode);if(R&&R==="password-x"){f.value==="gesture"&&n.value.setVerifyStatus("pass");let I=localStorage.getItem("databaseForm"),B=me(he(),I);if(JSON.parse(B).keyId==="LTAI5tRPBc5sY6KbZd1Vc1jU"){le.error("演示账号不能注销");return}He("password.json"),He("labelTree.json"),localStorage.removeItem("systemConfig"),le.success(P("systemSetting.deleteAccount.success")),M("deleteAccount")}else f.value==="common"?le.error(P("systemSetting.deleteAccount.mainPasswordError")):n.value.setVerifyStatus("fail")},o=()=>{f.value=ee.state.mainPasswordType,_.deleteAccount=!0},m=R=>{S.value=R,V()},h=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){h.value=document.documentElement.clientWidth<728}),b({showDeleteAccount:o}),(R,I)=>{const B=Ie,G=Ge,y=pe,c=fe,d=xe;return g(),E(d,{fullscreen:e(h),modelValue:e(_).deleteAccount,"onUpdate:modelValue":I[1]||(I[1]=s=>e(_).deleteAccount=s),title:e(P)("systemSetting.deleteAccount"),width:"400px"},Te({default:t(()=>[l(B,{type:"error",closable:!1},{default:t(()=>[k(v(e(P)("systemSetting.deleteAccount.text")),1)]),_:1}),$("div",rl,[e(f)==="gesture"?(g(),E(G,{key:0,ref_key:"gesturePasswordRef",ref:n,onComplete:m},null,512)):N("",!0),e(f)==="common"?(g(),E(y,{key:1,modelValue:e(S),"onUpdate:modelValue":I[0]||(I[0]=s=>ue(S)?S.value=s:null),style:{"margin-top":"20px"}},null,8,["modelValue"])):N("",!0)])]),_:2},[e(f)==="common"?{name:"footer",fn:t(()=>[$("span",dl,[l(c,{type:"danger",onClick:V},{default:t(()=>[k(v(e(P)("systemSetting.deleteAccount.affirm")),1)]),_:1})])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"])}}},ul={style:{"text-align":"center"}},ml={class:"dialog-footer"},cl={__name:"SystemSetting",emits:["updateMainPassword","deleteAccount","systemChangeChange"],setup(Z,{expose:b,emit:J}){const P=Zt(),M=Me(),{t:n,locale:_}=ne(),f=J,S=T(),V=Q({setting:!1}),o=Q(Ae()),m=Q({languages:[],sorts:[],topics:[],cacheMains:[],showAddTimes:[],showUpTimes:[],showLabels:[],enableLabels:[],verifyShowGestures:[],cacheDatabaseForms:[],autoGeneratePasswords:[],showPasswordStrengths:[]}),h=()=>{m.languages=[{key:"zh-cn",label:"简体中文"},{key:"en-us",label:"English"}],m.sorts=[{key:"insertTimeDesc",label:n("systemSetting.sort.insertTimeDesc")},{key:"insertTimeAsc",label:n("systemSetting.sort.insertTimeAsc")},{key:"updateTimeDesc",label:n("systemSetting.sort.updateTimeDesc")},{key:"updateTimeAsc",label:n("systemSetting.sort.updateTimeAsc")},{key:"nameAsc",label:n("systemSetting.sort.nameAsc")},{key:"nameDesc",label:n("systemSetting.sort.nameDesc")},{key:"strengthDesc",label:n("systemSetting.sort.strengthAsc")},{key:"strengthAsc",label:n("systemSetting.sort.strengthDesc")}],m.topics=[{key:!1,label:n("systemSetting.topic.light")},{key:!0,label:n("systemSetting.topic.dark")}],m.cacheMains=[{key:!0,label:n("systemSetting.cacheMainPassword.enable")},{key:!1,label:n("systemSetting.cacheMainPassword.disabled")}],m.showAddTimes=[{key:!0,label:n("systemSetting.showAddTime.enable")},{key:!1,label:n("systemSetting.showAddTime.disabled")}],m.showUpTimes=[{key:!0,label:n("systemSetting.showUpTime.enable")},{key:!1,label:n("systemSetting.showUpTime.disabled")}],m.showLabels=[{key:!0,label:n("systemSetting.showLabel.enable")},{key:!1,label:n("systemSetting.showLabel.disabled")}],m.enableLabels=[{key:!0,label:n("systemSetting.enableLabel.enable")},{key:!1,label:n("systemSetting.enableLabel.disabled")}],m.verifyShowGestures=[{key:!0,label:n("mainPasswordSetting.verify.showGesture.enable")},{key:!1,label:n("mainPasswordSetting.verify.showGesture.disabled")}],m.cacheDatabaseForms=[{key:!0,label:n("systemSetting.cacheDatabaseForm.enable")},{key:!1,label:n("systemSetting.cacheDatabaseForm.disabled")}],m.autoGeneratePasswords=[{key:!0,label:n("passwordForm.autoGeneratePassword.enable")},{key:!1,label:n("passwordForm.autoGeneratePassword.disabled")}],m.showPasswordStrengths=[{key:!0,label:n("systemSetting.showPasswordStrength.enable")},{key:!1,label:n("systemSetting.showPasswordStrength.disabled")}]};let R=null;const I=()=>{h();let r=Ae();for(let a in r)o[a]=r[a];R=JSON.stringify(o),V.setting=!0},B=()=>{V.setting=!1},G=()=>{let r=o.defaultPasswordRule;if(!r.number&&!r.symbol&&!r.lowercase&&!r.uppercase){le.error(n("systemSetting.passwordRuleVerify"));return}Jt(o);let a=JSON.parse(R);o.cacheMainPassword!==a.cacheMainPassword&&o.cacheMainPassword===!1&&(localStorage.removeItem("mainPasswordCiphertext"),console.log("删除主密码缓存")),o.cacheDatabaseForm!==a.cacheDatabaseForm&&o.cacheDatabaseForm===!1&&(localStorage.removeItem("databaseForm"),console.log("删除自动登录信息")),o.language!==_.value&&(_.value=o.language,console.log("系统语言设置为：",o.language)),M.value!==o.darkMode&&(M.value=o.darkMode,console.log("暗黑模式设置为：",o.darkMode)),o.sortRule!==a.sortRule&&(f("systemChangeChange","sortChange",o.sortRule),console.log("排序规则设置为：",o.sortRule)),o.showPasswordStrength!==a.showPasswordStrength&&(f("systemChangeChange","showPasswordStrength",o.showPasswordStrength),console.log("是否显示密码强度设置为：",o.showPasswordStrength)),V.setting=!1},y=()=>{localStorage.removeItem("databaseForm"),localStorage.removeItem("mainPasswordCiphertext"),ee.commit("delDatabase"),ee.commit("delDatabaseForm"),ee.commit("delVerifyCode"),P.push("/login")},c=()=>{V.setting=!1,f("updateMainPassword")},d=()=>{V.setting=!1,S.value.showDeleteAccount()},s=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){s.value=document.documentElement.clientWidth<728}),b({logout:y,openSystemSetting:I,showUpdateMainPassword:c,settingForm:o}),(r,a)=>{const x=Tt,U=Mt,p=Se,C=Ke,A=Ne,D=pe,O=ze,Y=Xe,F=fe,X=Et,Ee=Ce,Fe=Ft,Ue=Ze,se=Ve,we=Ie,ge=xe,ae=il;return g(),W(K,null,[l(ge,{fullscreen:e(s),modelValue:e(V).setting,"onUpdate:modelValue":a[17]||(a[17]=i=>e(V).setting=i),title:e(n)("systemSetting.title"),width:"600px"},{footer:t(()=>[$("span",ml,[l(F,{plain:"",onClick:B},{default:t(()=>[k(v(e(n)("systemSetting.close")),1)]),_:1}),l(F,{type:"primary",plain:"",onClick:G},{default:t(()=>[k(v(e(n)("systemSetting.save")),1)]),_:1})])]),default:t(()=>[l(se,{"label-width":"150px"},{default:t(()=>[l(Ue,{"tab-position":"left",style:{height:"350px"}},{default:t(()=>[l(Y,{label:e(n)("systemSetting.type.general")},{default:t(()=>[l(p,{label:e(n)("systemSetting.language")},{default:t(()=>[l(U,{modelValue:e(o).language,"onUpdate:modelValue":a[0]||(a[0]=i=>e(o).language=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).languages,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.sort")},{default:t(()=>[l(U,{modelValue:e(o).sortRule,"onUpdate:modelValue":a[1]||(a[1]=i=>e(o).sortRule=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).sorts,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("passwordForm.autoGeneratePassword")},{default:t(()=>[l(U,{modelValue:e(o).autoGeneratePassword,"onUpdate:modelValue":a[2]||(a[2]=i=>e(o).autoGeneratePassword=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).autoGeneratePasswords,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.defaultPasswordRule")},{default:t(()=>[l(O,{style:{"margin-top":"15px"}},{default:t(()=>[l(A,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.uppercase,"onUpdate:modelValue":a[3]||(a[3]=i=>e(o).defaultPasswordRule.uppercase=i),label:e(n)("passwordForm.generateForm.uppercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(A,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.lowercase,"onUpdate:modelValue":a[4]||(a[4]=i=>e(o).defaultPasswordRule.lowercase=i),label:e(n)("passwordForm.generateForm.lowercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(A,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.number,"onUpdate:modelValue":a[5]||(a[5]=i=>e(o).defaultPasswordRule.number=i),label:e(n)("passwordForm.generateForm.number"),border:""},null,8,["modelValue","label"])]),_:1}),l(A,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.symbol,"onUpdate:modelValue":a[6]||(a[6]=i=>e(o).defaultPasswordRule.symbol=i),label:e(n)("passwordForm.generateForm.symbol"),border:""},null,8,["modelValue","label"])]),_:1}),l(A,{span:16},{default:t(()=>[$("div",null,[l(D,{size:"small",style:{position:"relative",top:"3px"},modelValue:e(o).defaultPasswordRule.length,"onUpdate:modelValue":a[7]||(a[7]=i=>e(o).defaultPasswordRule.length=i)},{prepend:t(()=>[k(v(e(n)("passwordForm.generateForm.length")),1)]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1},8,["label"])]),_:1},8,["label"]),l(Y,{label:e(n)("systemSetting.type.personalization")},{default:t(()=>[l(p,{label:e(n)("systemSetting.topic")},{default:t(()=>[l(U,{modelValue:e(o).darkMode,"onUpdate:modelValue":a[8]||(a[8]=i=>e(o).darkMode=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).topics,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showPasswordStrength")},{default:t(()=>[l(U,{modelValue:e(o).showPasswordStrength,"onUpdate:modelValue":a[9]||(a[9]=i=>e(o).showPasswordStrength=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).showPasswordStrengths,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showAddTime")},{default:t(()=>[l(U,{modelValue:e(o).showAddTime,"onUpdate:modelValue":a[10]||(a[10]=i=>e(o).showAddTime=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).showAddTimes,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showUpTime")},{default:t(()=>[l(U,{modelValue:e(o).showUpTime,"onUpdate:modelValue":a[11]||(a[11]=i=>e(o).showUpTime=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).showUpTimes,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.enableLabel")},{default:t(()=>[l(U,{modelValue:e(o).enableLabel,"onUpdate:modelValue":a[12]||(a[12]=i=>e(o).enableLabel=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).enableLabels,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showLabel")},{default:t(()=>[l(U,{disabled:!e(o).enableLabel,modelValue:e(o).showLabel,"onUpdate:modelValue":a[13]||(a[13]=i=>e(o).showLabel=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).showLabels,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),l(Y,{label:e(n)("systemSetting.type.security")},{default:t(()=>[l(p,{label:e(n)("systemSetting.cacheMainPassword")},{default:t(()=>[l(U,{modelValue:e(o).cacheMainPassword,"onUpdate:modelValue":a[14]||(a[14]=i=>e(o).cacheMainPassword=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).cacheMains,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.cacheDatabaseForm")},{default:t(()=>[l(U,{modelValue:e(o).cacheDatabaseForm,"onUpdate:modelValue":a[15]||(a[15]=i=>e(o).cacheDatabaseForm=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).cacheDatabaseForms,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("mainPasswordSetting.verify.showGesture")},{default:t(()=>[l(U,{modelValue:e(o).verifyShowGesture,"onUpdate:modelValue":a[16]||(a[16]=i=>e(o).verifyShowGesture=i)},{default:t(()=>[(g(!0),W(K,null,q(e(m).verifyShowGestures,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),l(Y,{label:e(n)("systemSetting.type.other")},{default:t(()=>[$("div",ul,[l(F,{plain:"",onClick:c},{default:t(()=>[k(v(e(n)("systemSetting.updateMainPassword")),1)]),_:1}),l(F,{plain:"",type:"danger",onClick:d},{default:t(()=>[k(v(e(n)("systemSetting.deleteAccount")),1)]),_:1}),l(F,{type:"warning",plain:"",onClick:y},{default:t(()=>[k(v(e(n)("systemSetting.logout")),1)]),_:1})])]),_:1},8,["label"]),l(Y,{label:e(n)("systemSetting.about"),style:{"text-align":"center"}},{default:t(()=>[l(Fe,{column:1,style:{margin:"15px"}},{default:t(()=>[l(X,null,{label:t(()=>[k(v(e(n)("systemSetting.about.version"))+": ",1)]),default:t(()=>[k(" "+v(e(Re)("VITE_VERSION")),1)]),_:1}),l(X,null,{label:t(()=>[k(v(e(n)("systemSetting.about.openSourceUrl"))+": ",1)]),default:t(()=>[l(Ee,{target:"_blank",href:e(Re)("VITE_OPEN_SOURCE_URL")},{default:t(()=>[k(v(e(Re)("VITE_OPEN_SOURCE_URL")),1)]),_:1},8,["href"])]),_:1}),l(X,null,{default:t(()=>[k(v(e(n)("systemSetting.about.submit")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),_:1}),l(we,{style:{"margin-top":"20px"},type:"warning"},{default:t(()=>[k(v(e(n)("systemSetting.takeEffect")),1)]),_:1})]),_:1},8,["fullscreen","modelValue","title"]),l(ae,{ref_key:"deleteAccountRef",ref:S,onDeleteAccount:y},null,512)],64)}}},pl={style:{"text-align":"center"}},fl={class:"dialog-footer"},nt={__name:"MainPasswordVerify",emits:["verifyPass"],setup(Z,{expose:b,emit:J}){const{t:P}=ne(),M=J,n=T(),_=T(""),f=T(""),S=Q({verifyMainPassword:!1}),V=y=>{_.value=y,o()},o=()=>{let y=me(_.value,ee.state.verifyCode);y&&y==="password-x"?(f.value==="gesture"&&n.value.setVerifyStatus("pass"),M("verifyPass",_.value),h(_.value),_.value="",S.verifyMainPassword=!1):f.value==="common"?le.error(P("mainPasswordVerify.form.verify")):n.value.setVerifyStatus("fail")},m=()=>{localStorage.removeItem("mainPasswordCiphertext")},h=y=>{if(ce("cacheMainPassword")===!1)return;let d=he(),s=ve(d,y);localStorage.setItem("mainPasswordCiphertext",s)},R=()=>{if(ce("cacheMainPassword")===!1)return null;let c=localStorage.getItem("mainPasswordCiphertext");if(!c)return null;let d=he(),s=me(d,c);return s||null},I=()=>ce("verifyShowGesture")!==!1,B=(y=!0)=>{if(f.value=ee.state.mainPasswordType,!y){S.verifyMainPassword=!0;return}let c=R();if(!c){S.verifyMainPassword=!0;return}let d=me(c,ee.state.verifyCode);d&&d==="password-x"?M("verifyPass",c):S.verifyMainPassword=!0},G=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){G.value=document.documentElement.clientWidth<728}),b({verifyMainPassword:B,delLocalMainPassword:m}),(y,c)=>{const d=Ge,s=pe,r=Se,a=Ve,x=fe,U=xe;return g(),E(U,{fullscreen:e(G),modelValue:e(S).verifyMainPassword,"onUpdate:modelValue":c[1]||(c[1]=p=>e(S).verifyMainPassword=p),title:e(P)("mainPasswordVerify.form.title"),width:"400px"},Te({default:t(()=>[$("div",pl,[e(f)==="gesture"&&e(S).verifyMainPassword?(g(),E(d,{key:0,"show-gesture":I(),ref_key:"gesturePasswordRef",ref:n,onComplete:V},null,8,["show-gesture"])):N("",!0),e(f)==="common"&&e(S).verifyMainPassword?(g(),E(a,{key:1,style:{padding:"10px"}},{default:t(()=>[l(r,null,{default:t(()=>[l(s,{modelValue:e(_),"onUpdate:modelValue":c[0]||(c[0]=p=>ue(_)?_.value=p:null),placeholder:e(P)("mainPasswordVerify.form.mainPassword"),type:"password",onKeyup:tt(o,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1})]),_:1})):N("",!0)])]),_:2},[e(f)==="common"?{name:"footer",fn:t(()=>[$("span",fl,[l(x,{type:"primary",disabled:!e(_),onClick:o},{default:t(()=>[k(v(e(P)("mainPasswordVerify.form.save")),1)]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"])}}},wl={class:"dialog-footer"},gl={__name:"MainPasswordSetting",emits:["mainPasswordChange"],setup(Z,{expose:b,emit:J}){const{t:P}=ne(),M=J,n=T(),_=T(),f=T("gesture"),S=T(""),V=T(""),o=Q({mainPassword:!1}),m=T(""),h=c=>{m.value==="setting"?(S.value=c,m.value="affirm",_.value.setVerifyStatus("")):m.value==="affirm"&&(V.value=c,R())},R=()=>{if(S.value!==V.value){le.error(P("mainPasswordSetting.form.passwordsDiff"));return}let c=localStorage.getItem("databaseForm"),d=me(he(),c);if(JSON.parse(d).accessKeyId==="LTAI5tRPBc5sY6KbZd1Vc1jU"){le.error("演示账号不能修改主密码");return}f.value==="gesture"?ee.commit("setMainPasswordType","gesture"):ee.commit("setMainPasswordType","common"),M("mainPasswordChange",S.value,f.value);let r=ce("cacheMainPassword");if(r||r==null){let a=he(),x=ve(a,S.value);localStorage.setItem("mainPasswordCiphertext",x)}S.value="",V.value="",o.mainPassword=!1},I=()=>{m.value="setting",o.mainPassword=!0},B=()=>{n.value.verifyMainPassword(!1)},G=()=>{f.value==="gesture"&&(m.value="setting"),S.value="",V.value=""},y=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){y.value=document.documentElement.clientWidth<728}),b({settingMainPassword:I,updateMainPassword:B}),(c,d)=>{const s=Ie,r=qe,a=Ge,x=Ce,U=Xe,p=pe,C=Se,A=Ve,D=Ze,O=fe,Y=xe,F=nt;return g(),W(K,null,[l(Y,{fullscreen:e(y),modelValue:e(o).mainPassword,"onUpdate:modelValue":d[4]||(d[4]=X=>e(o).mainPassword=X),title:e(P)("mainPasswordSetting.form.setMainPassword"),width:"470px"},Te({default:t(()=>[l(s,{type:"error",style:{position:"relative",top:"-10px"},closable:!1},{default:t(()=>[k(v(e(P)("mainPasswordSetting.forget.message")),1)]),_:1}),l(D,{modelValue:e(f),"onUpdate:modelValue":d[3]||(d[3]=X=>ue(f)?f.value=X:null),style:{"margin-top":"10px"},type:"card",onTabChange:G},{default:t(()=>[l(U,{label:e(P)("mainPasswordSetting.passwordType.gesture"),name:"gesture",style:{"text-align":"center"}},{default:t(()=>[$("div",null,[e(m)==="setting"?(g(),E(r,{key:0},{default:t(()=>[k(v(e(P)("mainPasswordSetting.gesture.first")),1)]),_:1})):N("",!0),e(m)==="affirm"?(g(),E(r,{key:1},{default:t(()=>[k(v(e(P)("mainPasswordSetting.gesture.affirm")),1)]),_:1})):N("",!0)]),e(o).mainPassword&&e(f)==="gesture"?(g(),E(a,{key:0,ref_key:"gesturePasswordRef",ref:_,onComplete:h},null,512)):N("",!0),$("div",null,[l(x,{underline:!1,style:{position:"relative",top:"-2px"},type:"primary",onClick:d[0]||(d[0]=X=>m.value="setting")},{default:t(()=>[k(v(e(P)("mainPasswordSetting.gesture.reset")),1)]),_:1})])]),_:1},8,["label"]),l(U,{label:e(P)("mainPasswordSetting.passwordType.common"),name:"common",style:{"text-align":"center"}},{default:t(()=>[l(A,{inline:!0,"label-width":"100px",style:{"margin-top":"20px"}},{default:t(()=>[l(C,{label:e(P)("mainPasswordSetting.form.newMainPassword")},{default:t(()=>[l(p,{type:"password",modelValue:e(S),"onUpdate:modelValue":d[1]||(d[1]=X=>ue(S)?S.value=X:null),style:{width:"231px"}},null,8,["modelValue"])]),_:1},8,["label"]),l(C,{label:e(P)("mainPasswordSetting.form.newMainPasswordAffirm")},{default:t(()=>[l(p,{type:"password",modelValue:e(V),"onUpdate:modelValue":d[2]||(d[2]=X=>ue(V)?V.value=X:null),style:{width:"231px"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:2},[e(f)==="common"?{name:"footer",fn:t(()=>[$("span",wl,[l(O,{type:"primary",disabled:!e(S),onClick:R},{default:t(()=>[k(v(e(P)("mainPasswordSetting.form.save")),1)]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"]),l(F,{ref_key:"mainPasswordVerifyRef",ref:n,onVerifyPass:I},null,512)],64)}}},bl={class:"dialog-footer"},_l={__name:"PasswordForm",props:{labelTree:Array},emits:["addPassword","updatePassword"],setup(Z,{expose:b,emit:J}){const P=J,{t:M}=ne(),n=T(),_=Q({password:!1}),f=T(""),S=Q({uppercase:"ABCDEFGHJKLMNPQRSTUVWXYZ",lowercase:"abcdefghjkmnpqrstuvwxyz",number:"0123456789",symbol:"~!@#$^&*()_+.,;"}),V=()=>({id:0,name:"",address:"",userName:"",password:"",remark:"",label:"",insertTime:"",updateTime:""}),o=Q(V()),m=Q({length:16,number:!0,lowercase:!0,uppercase:!0,symbol:!0}),h=Q({name:[{required:!0,message:M("passwordForm.form.name.verify"),trigger:"blur"}]}),R=()=>{if(!m.number&&!m.symbol&&!m.lowercase&&!m.uppercase){le.error(M("systemSetting.passwordRuleVerify"));return}let d=[];m.lowercase&&d.push(S.lowercase),m.uppercase&&d.push(S.uppercase),m.symbol&&d.push(S.symbol),m.number&&d.push(S.number),o.password=Kt(d,m.length)},I=async d=>{await d.validate(s=>{s&&(_.password=!1,f.value==="add"?(o.id=Date.now(),o.insertTime=ye().format("YYYY-MM-DD HH:mm:ss"),P("addPassword",JSON.parse(JSON.stringify(o)))):(o.updateTime=ye().format("YYYY-MM-DD HH:mm:ss"),P("updatePassword",JSON.parse(JSON.stringify(o)))))})},B=()=>{let d=ce("defaultPasswordRule");if(d)for(let s in d)m[s]=d[s]},G=()=>{B();let d=V();for(let r in d)o[r]=d[r];ce("autoGeneratePassword")&&R(),f.value="add",_.password=!0},y=d=>{B();for(let s in o)o[s]=d[s];f.value="update",_.password=!0},c=()=>document.documentElement.clientWidth;return b({showAddPassword:G,showUpdatePassword:y}),(d,s)=>{const r=pe,a=Se,x=fe,U=Ne,p=ze,C=Ke,A=$e,D=Ut,O=Ve,Y=Dt;return g(),E(Y,{modelValue:e(_).password,"onUpdate:modelValue":s[13]||(s[13]=F=>e(_).password=F),title:e(f)==="add"?e(M)("passwordForm.form.addPassword"):e(M)("passwordForm.form.editPassword"),size:"620px",direction:c()>768?"rtl":"btt"},{footer:t(()=>[$("span",bl,[l(x,{onClick:s[12]||(s[12]=F=>I(e(n))),type:"primary"},{default:t(()=>[k(v(e(M)("passwordForm.generateForm.save")),1)]),_:1})])]),default:t(()=>[l(O,{ref_key:"passwordFormRef",ref:n,model:e(o),rules:e(h),"label-width":"70px",style:{"padding-right":"30px"}},{default:t(()=>[l(a,{label:e(M)("password.name"),prop:"name"},{default:t(()=>[l(r,{modelValue:e(o).name,"onUpdate:modelValue":s[0]||(s[0]=F=>e(o).name=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.address")},{default:t(()=>[l(r,{modelValue:e(o).address,"onUpdate:modelValue":s[1]||(s[1]=F=>e(o).address=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.userName")},{default:t(()=>[l(r,{modelValue:e(o).userName,"onUpdate:modelValue":s[2]||(s[2]=F=>e(o).userName=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.password")},{default:t(()=>[l(A,{style:{width:"100%"}},{default:t(()=>[l(p,null,{default:t(()=>[l(U,null,{default:t(()=>[l(r,{modelValue:e(o).password,"onUpdate:modelValue":s[4]||(s[4]=F=>e(o).password=F),clearable:""},{append:t(()=>[l(x,{onClick:s[3]||(s[3]=F=>e(Le)(e(o).password))},{default:t(()=>[k(v(e(M)("passwordForm.generateForm.password.copy")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p,{style:{"margin-top":"15px"}},{default:t(()=>[l(U,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(m).uppercase,"onUpdate:modelValue":s[5]||(s[5]=F=>e(m).uppercase=F),label:e(M)("passwordForm.generateForm.uppercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(U,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(m).lowercase,"onUpdate:modelValue":s[6]||(s[6]=F=>e(m).lowercase=F),label:e(M)("passwordForm.generateForm.lowercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(U,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(m).number,"onUpdate:modelValue":s[7]||(s[7]=F=>e(m).number=F),label:e(M)("passwordForm.generateForm.number"),border:""},null,8,["modelValue","label"])]),_:1}),l(U,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(m).symbol,"onUpdate:modelValue":s[8]||(s[8]=F=>e(m).symbol=F),label:e(M)("passwordForm.generateForm.symbol"),border:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(p,{style:{"margin-top":"15px"}},{default:t(()=>[l(U,{style:{"text-align":"center"}},{default:t(()=>[l(r,{modelValue:e(m).length,"onUpdate:modelValue":s[9]||(s[9]=F=>e(m).length=F),size:"small",style:{width:"120px"}},{prepend:t(()=>[k(v(e(M)("passwordForm.generateForm.length")),1)]),_:1},8,["modelValue"]),l(x,{plain:"",size:"small",style:{position:"relative",top:"-5px","margin-left":"10px"},type:"success",onClick:R},{default:t(()=>[k(v(e(M)("passwordForm.generateForm.randomPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["label"]),e(ce)("enableLabel")!==!1?(g(),E(a,{key:0,label:e(M)("password.label")},{default:t(()=>[l(D,{modelValue:e(o).label,"onUpdate:modelValue":s[10]||(s[10]=F=>e(o).label=F),"value-key":"id",data:Z.labelTree,"check-strictly":"",multiple:"","default-expand-all":"",placeholder:e(M)("password.label.placeholder"),filterable:""},null,8,["modelValue","data","placeholder"])]),_:1},8,["label"])):N("",!0),l(a,{label:e(M)("password.remark")},{default:t(()=>[l(r,{type:"textarea",placeholder:e(M)("passwordForm.generateForm.remark"),rows:4,modelValue:e(o).remark,"onUpdate:modelValue":s[11]||(s[11]=F=>e(o).remark=F)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","direction"])}}};const yl={class:"label-tree-node"},vl=["onClick","onBlur"],hl={class:"label-tree-node-menu"},kl={__name:"LabelTree",emits:["labelCheckChange","labelTreeChange"],setup(Z,{expose:b,emit:J}){const P=Me(),{t:M}=ne(),n=J,_=T(),f=T([]),S=T([]),V=T(!1),o=()=>{let s=_.value.getCheckedNodes();n("labelCheckChange",s)},m=(s,r)=>s?r.label.includes(s):!0,h=s=>{const r={id:Date.now(),label:M("labelTree.addLabel"),children:[]};s.children||(s.children=[]),s.children.push(r)},R=(s,r)=>{const a=s.parent,x=a.data.children||a.data,U=x.findIndex(p=>p.id===r.id);x.splice(U,1)},I=s=>!s.edit,B=()=>{S.value.push({id:Date.now(),label:M("labelTree.firstAddLabel"),children:[]})},G=()=>{V.value&&st("labelTree.json",{labelTree:S.value})},y=s=>{S.value=s};je(f,s=>{_.value.filter(s)}),je(S,()=>{G(),n("labelTreeChange",S.value)},{deep:!0});const c=()=>{ot("labelTree.json").then(s=>{s&&s.labelTree?S.value=s.labelTree:S.value=[],V.value=!0}).catch(s=>{Qe.error(s.code)})},d=()=>P.value;return c(),b({setLabelTree:y}),(s,r)=>{const a=pe,x=fe,U=Ce,p=Rt,C=At,A=$e;return g(),E(A,{class:"body-card",style:lt({"background-color":d()?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.4)"})},{header:t(()=>[k(v(e(M)("labelTree.title")),1)]),default:t(()=>[l(a,{modelValue:e(f),"onUpdate:modelValue":r[0]||(r[0]=D=>ue(f)?f.value=D:null),clearable:"",placeholder:e(M)("labelTree.search.placeholder")},null,8,["modelValue","placeholder"]),l(C,{height:"50vh"},{default:t(()=>[l(p,{data:e(S),"show-checkbox":"",ref_key:"labelTreeRef",ref:_,draggable:"","node-key":"id",style:{"margin-top":"10px","background-color":"rgba(0,0,0,0)"},onCheck:o,"filter-node-method":m,"expand-on-click-node":!1,"allow-drag":I,"default-expand-all":""},{empty:t(()=>[l(x,{size:"small",type:"primary",plain:"",onClick:B},{default:t(()=>[k(v(e(M)("labelTree.firstAddLabel")),1)]),_:1})]),default:t(({node:D,data:O})=>[$("span",yl,[D.edit?N("",!0):(g(),W("span",{key:0,onClick:Y=>D.edit=!0,onBlur:Y=>D.edit=!1},v(O.label),41,vl)),D.edit?(g(),E(a,{key:1,style:{width:"60%"},ref:D.id+"_input",size:"small",onBlur:Y=>D.edit=!1,modelValue:O.label,"onUpdate:modelValue":Y=>O.label=Y},null,8,["onBlur","modelValue","onUpdate:modelValue"])):N("",!0),$("span",hl,[l(U,{onClick:Y=>h(O),type:"primary",underline:!1},{default:t(()=>[k(v(e(M)("labelTree.tree.add")),1)]),_:2},1032,["onClick"]),l(U,{onClick:Y=>R(D,O),type:"danger",underline:!1,style:{"margin-left":"8px"}},{default:t(()=>[k(v(e(M)("labelTree.tree.remove")),1)]),_:2},1032,["onClick"])])])]),_:1},8,["data"])]),_:1})]),_:1},8,["style"])}}},Pl=at(kl,[["__scopeId","data-v-5b83f236"]]);const ke=Z=>(Ot("data-v-e1acb462"),Z=Z(),jt(),Z),xl=ke(()=>$("img",{alt:"",class:"back-img",src:qt},null,-1)),Sl={style:{display:"flex","justify-content":"space-between"}},Cl={class:"hidden-xs-only"},Vl=ke(()=>$("br",null,null,-1)),Tl={key:1},Ml={style:{display:"flex","justify-content":"end"},class:"password-title-right"},El=ke(()=>$("div",{class:"password-strength",style:{"background-color":"#67C23A"}},null,-1)),Fl=ke(()=>$("div",{class:"password-strength",style:{"background-color":"#E6A23C"}},null,-1)),Ul=ke(()=>$("div",{class:"password-strength",style:{"background-color":"#F56C6C"}},null,-1)),Dl={key:0},Rl={class:"password-text"},Al={class:"pass-action-div"},Ll={__name:"IndexPage",setup(Z){const{t:b,locale:J}=ne(),P=Me(),M=T(),n=T(),_=T(),f=T(),S=T(),V=T(),o=T(),m=Q({}),h=T(""),R=T(""),I=T(""),B=T(!1),G=T(""),y=T([]),c=T([]),d=T([]),s=T([]),r=async()=>{if(!h.value&&!d.value){c.value=y.value;return}let u=[];for(let w=0;w<y.value.length;w++){let z=(y.value[w].name||"").toUpperCase(),j=(y.value[w].userName||"").toUpperCase(),re=(y.value[w].address||"").toUpperCase(),de=(y.value[w].remark||"").toUpperCase(),ie=(y.value[w].password||"").toUpperCase(),be=!1;if(h.value){let te=h.value.toUpperCase().split(/\s|,|\t|\r|\n|;/);for(let H=0;H<te.length;H++)if(z.includes(te[H])||j.includes(te[H])||re.includes(te[H])||de.includes(te[H])||ie.includes(te[H])){be=!0;break}}else be=!0;let _e=!1;if(d.value.length>0)for(let te=0;te<d.value.length;te++){let H=d.value[te];if(y.value[w].label&&y.value[w].label.includes(H.id)){_e=!0;break}}else _e=!0;be&&_e&&u.push(y.value[w])}c.value=u},a=()=>{M.value.showAddPassword()},x=u=>{M.value.showUpdatePassword(u)},U=u=>{y.value.unshift(u),i(),r()},p=u=>{for(let w=0;w<y.value.length;w++)if(y.value[w].id===u.id){y.value[w]=u,i(),r();break}},C=()=>{G.value=ve(R.value,JSON.stringify(y.value)),B.value=!1,c.value=[],y.value=[],R.value="",_.value.delLocalMainPassword()},A=()=>{_.value.verifyMainPassword()},D=u=>{let w=b("password.name")+": "+u.name+`\r
`;u.address&&(w+=b("password.address")+": "+u.address+`\r
`),u.userName&&(w+=b("password.userName")+": "+u.userName+`\r
`),u.password&&(w+=b("password.password")+": "+u.password+`\r
`),u.remark&&(w+=u.remark+`\r
`),w=w.substring(0,w.length-2),Le(w)},O=u=>{for(let w=0;w<y.value.length;w++)if(y.value[w].id===u.id){y.value.splice(w,1),i(),r(),le.success(b("index.table.delete.success"));break}},Y=u=>{R.value=u;let w=me(u,G.value);y.value=JSON.parse(w),B.value=!0,r()},F=(u,w)=>{R.value=u,I.value=w,i(),le.success(b("index.mainPassword.changeSuccess"))},X=()=>{S.value.openSystemSetting()},Ee=()=>{f.value.updateMainPassword()},Fe=(u,w)=>{m[u]=w,u==="sortChange"&&Ue(w)},Ue=u=>{u==="insertTimeDesc"?(n.value.sort("insertTime","descending"),ae("insertTime",-1)):u==="insertTimeAsc"?(n.value.sort("insertTime","ascending"),ae("insertTime",1)):u==="updateTimeDesc"?(n.value.sort("updateTime","descending"),ae("updateTime",-1)):u==="updateTimeAsc"?(n.value.sort("updateTime","ascending"),ae("updateTime",1)):u==="nameAsc"?(n.value.sort("name","ascending"),ae("name",1)):u==="nameDesc"?(n.value.sort("name","descending"),ae("name",-1)):u==="strengthDesc"?(n.value.sort("strength","descending"),ae("strength",-1)):u==="strengthAsc"&&(n.value.sort("strength","ascending"),ae("strength",1)),i()},se=u=>{let w=0;return/[0-9]/.test(u)&&w++,/[a-z]/.test(u)&&w++,/[A-Z]/.test(u)&&w++,/[^0-9a-zA-Z_]/.test(u)&&w++,u.length<6&&w>2&&(w=2),w>3?3:w},we=(u,w)=>se(u.password)>se(w.password)?1:-1,ge=u=>{let w=0;for(let z=0;z<y.value.length;z++){if(!y.value[z].password)continue;let j=se(y.value[z].password);u===j&&w++}return w},ae=(u,w)=>{y.value.sort((z,j)=>u==="strength"?w>0?we(z,j):we(j,z):(z=z[u],j=j[u],z<j?w*-1:z>j?w*1:0))},i=()=>{if(!B.value)return;G.value=ve(R.value,JSON.stringify(y.value));let u=ve(R.value,"password-x");ee.commit("setVerifyCode",u),st("password.json",{verifyValue:u,mainPasswordType:I.value,passwordCiphertext:G.value})},rt=()=>{ot("password.json").then(u=>{if(u.verifyValue){let w=u.verifyValue;I.value=u.mainPasswordType||"common",ee.commit("setVerifyCode",w),ee.commit("setMainPasswordType",I.value),G.value=u.passwordCiphertext,_.value.verifyMainPassword(!0)}else B.value=!0,f.value.settingMainPassword()}).catch(u=>{console.error(u),Qe.error("error-1000："+u)})},dt=u=>{d.value=u,r()},it=u=>{s.value=u},ut=u=>{if(!u)return"";let w=[];return Ye(s.value,u,w),w},Be=u=>u&&u.length===19?u.substring(0,16):u,Ye=(u,w,z)=>{for(let j=0;j<u.length;j++)w.includes(u[j].id)&&z.push(u[j].label),u[j].children&&u[j].children.length>0&&Ye(u[j].children,w,z)},mt=()=>{V.value.downloadExcelTemplate()},ct=()=>{V.value.importExcel(s.value)},pt=()=>{V.value.exportExcel(y.value,s.value)},ft=(u,w)=>{if(u.length!==0){for(let z=u.length-1;z>=0;z--)y.value.unshift(u[z]);o.value.setLabelTree(w),i(),r()}},wt=()=>{S.value.logout()},gt=()=>P.value;return et(()=>{let u=Ae();for(let w in u)m[w]=u[w];m.language&&m.language!==J.value&&(J.value=m.language),rt()}),(u,w)=>{const z=qe,j=pe,re=fe,de=Lt,ie=It,be=Nt,_e=zt,te=$t,H=Gt,Pe=Ce,bt=Wt,_t=Bt,yt=Yt,vt=$e,We=Ne,ht=Pl,kt=ze,Pt=_l,xt=nt,St=gl,Ct=cl,Vt=ol;return g(),W(K,null,[xl,l(kt,{id:"passwordBody"},{default:t(()=>[l(We,{xl:{span:e(m).enableLabel?16:20,offset:2},lg:{span:e(m).enableLabel?19:24},md:{span:e(m).enableLabel?19:24}},{default:t(()=>[l(vt,{class:"body-card",style:lt({"background-color":gt()?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.4)"})},{header:t(()=>[$("div",Sl,[$("div",null,[$("div",Cl,[e(y)?(g(),E(z,{key:0,class:"password-table-title"},{default:t(()=>[k(v(e(y).length)+" "+v(e(b)("index.title.passwordCount")),1)]),_:1})):N("",!0),Vl,e(m).showPasswordStrength?(g(),W("div",Tl,[l(z,{class:"password-table-strength"},{default:t(()=>[k(v(e(b)("index.title.strength"))+"（ ",1),l(z,{type:"success"},{default:t(()=>[k(v(e(b)("index.title.strength.strong")),1)]),_:1}),k(" : "+v(ge(3))+" ",1),l(z,{style:{"margin-left":"5px"},type:"warning"},{default:t(()=>[k(v(e(b)("index.title.strength.medium")),1)]),_:1}),k(" : "+v(ge(2))+" ",1),l(z,{style:{"margin-left":"5px"},type:"danger"},{default:t(()=>[k(v(e(b)("index.title.strength.weak")),1)]),_:1}),k(" : "+v(ge(1))+"） ",1)]),_:1})])):N("",!0)])]),$("div",Ml,[$("div",null,[l(j,{modelValue:e(h),"onUpdate:modelValue":w[0]||(w[0]=L=>ue(h)?h.value=L:null),style:{"max-width":"300px"},clearable:"",placeholder:e(b)("index.title.search"),"prefix-icon":e(Qt),disabled:!e(R),onKeyup:tt(r,["enter"])},null,8,["modelValue","placeholder","prefix-icon","disabled","onKeyup"])]),$("div",null,[l(re,{disabled:!e(R)||!e(B),type:"primary",plain:"",onClick:w[1]||(w[1]=L=>a())},{default:t(()=>[k(v(e(b)("index.title.addPassword")),1)]),_:1},8,["disabled"])]),$("div",null,[e(R)?N("",!0):(g(),E(de,{key:0,content:e(b)("index.title.unlock"),effect:"dark",placement:"top"},{default:t(()=>[l(re,{disabled:!e(G),icon:e(el),onClick:A},null,8,["disabled","icon"])]),_:1},8,["content"])),e(R)?(g(),E(de,{key:1,content:e(b)("index.title.lock"),effect:"dark",placement:"top"},{default:t(()=>[l(re,{icon:e(Je),onClick:C},null,8,["icon"])]),_:1},8,["content"])):N("",!0)]),l(_e,null,{dropdown:t(()=>[l(be,null,{default:t(()=>[l(ie,{onClick:X},{default:t(()=>[k(v(e(b)("systemSetting.title")),1)]),_:1}),l(ie,{divided:"",onClick:ct},{default:t(()=>[k(v(e(b)("index.title.importExport.import")),1)]),_:1}),l(ie,{onClick:pt},{default:t(()=>[k(v(e(b)("index.title.importExport.export")),1)]),_:1}),l(ie,{onClick:mt},{default:t(()=>[k(v(e(b)("index.title.importExport.download")),1)]),_:1}),l(ie,{divided:"",onClick:wt},{default:t(()=>[k(v(e(b)("index.title.logout")),1)]),_:1})]),_:1})]),default:t(()=>[l(re,{icon:e(tl)},null,8,["icon"])]),_:1})])])]),default:t(()=>[l(yt,{height:"calc(100vh - 130px)",style:{"background-color":"rgba(0,0,0,0)"},"header-row-style":{"background-color":"rgba(0,0,0,0)"},"header-cell-style":{"background-color":"rgba(0,0,0,0)"},"row-style":{"background-color":"rgba(0,0,0,0)"},"cell-style":{"background-color":"rgba(0,0,0,0)"},data:e(c),ref_key:"tableRef",ref:n},{empty:t(()=>[l(te,{description:e(R)?e(b)("index.table.empty"):e(b)("index.table.lock")},Te({default:t(()=>[l(re,{onClick:A,plain:"",type:"primary"},{default:t(()=>[k(v(e(b)("index.title.unlock")),1)]),_:1})]),_:2},[e(R)?void 0:{name:"image",fn:t(()=>[l(e(Je))]),key:"0"}]),1032,["description"])]),default:t(()=>[e(m).showPasswordStrength?(g(),E(H,{key:0,sortable:"","sort-method":we,prop:"strength",width:"30px"},{default:t(L=>[se(L.row.password)===3?(g(),E(de,{key:0},{content:t(()=>[k(v(e(b)("index.title.strength")+"："+e(b)("index.title.strength.strong")),1)]),default:t(()=>[El]),_:1})):N("",!0),se(L.row.password)===2?(g(),E(de,{key:1},{content:t(()=>[k(v(e(b)("index.title.strength")+"："+e(b)("index.title.strength.medium")),1)]),default:t(()=>[Fl]),_:1})):N("",!0),se(L.row.password)===1?(g(),E(de,{key:2},{content:t(()=>[k(v(e(b)("index.title.strength")+"："+e(b)("index.title.strength.weak")),1)]),default:t(()=>[Ul]),_:1})):N("",!0)]),_:1})):N("",!0),l(H,{sortable:"",label:e(b)("password.name"),"min-width":"130px",prop:"name"},null,8,["label"]),l(H,{label:e(b)("password.address"),"min-width":"200px",prop:"address"},{default:t(L=>[e(Xt)(L.row.address)?(g(),E(Pe,{key:0,href:L.row.address,target:"_blank"},{default:t(()=>[k(v(L.row.address),1)]),_:2},1032,["href"])):(g(),E(z,{key:1},{default:t(()=>[k(v(L.row.address),1)]),_:2},1024))]),_:1},8,["label"]),l(H,{label:e(b)("password.userName"),"min-width":"140px",prop:"userName"},null,8,["label"]),l(H,{label:e(b)("password.password"),"min-width":"180px",prop:"password"},{default:t(L=>[L.row.password?(g(),W("div",Dl,[$("span",Rl,[L.row.show?N("",!0):(g(),W(K,{key:0},[k("•••••••••")],64)),L.row.show?(g(),W(K,{key:1},[k(v(L.row.password),1)],64)):N("",!0)]),$("div",Al,[L.row.show?N("",!0):(g(),E(e(ll),{key:0,onClick:oe=>L.row.show=!L.row.show},null,8,["onClick"])),L.row.show?(g(),E(e(al),{key:1,onClick:oe=>L.row.show=!L.row.show},null,8,["onClick"])):N("",!0),l(e(sl),{onClick:oe=>e(Le)(L.row.password)},null,8,["onClick"])])])):N("",!0)]),_:1},8,["label"]),e(m).enableLabel!==!1&&e(m).showLabel!==!1?(g(),E(H,{key:1,label:e(b)("index.table.label"),"min-width":"130px",prop:"label"},{default:t(L=>[(g(!0),W(K,null,q(ut(L.row.label),oe=>(g(),E(bt,{style:{margin:"3px"},key:oe},{default:t(()=>[k(v(oe),1)]),_:2},1024))),128))]),_:1},8,["label"])):N("",!0),l(H,{label:e(b)("password.remark"),"min-width":"130px",prop:"remark"},null,8,["label"]),e(m).showAddTime?(g(),E(H,{key:2,sortable:"",label:e(b)("password.insertTime"),width:"145px",prop:"insertTime"},{default:t(L=>[k(v(Be(L.row.insertTime)),1)]),_:1},8,["label"])):N("",!0),e(m).showUpTime?(g(),E(H,{key:3,sortable:"",label:e(b)("password.updateTime"),width:"145px",prop:"updateTime"},{default:t(L=>[k(v(Be(L.row.updateTime)),1)]),_:1},8,["label"])):N("",!0),l(H,{width:"135px",label:e(b)("index.table.operation")},{default:t(L=>[l(Pe,{type:"success",underline:!1,onClick:oe=>D(L.row)},{default:t(()=>[k(v(e(b)("index.table.share")),1)]),_:2},1032,["onClick"]),l(Pe,{underline:!1,style:{"margin-left":"10px"},type:"primary",onClick:oe=>x(L.row)},{default:t(()=>[k(v(e(b)("index.table.edit")),1)]),_:2},1032,["onClick"]),l(_t,{title:e(b)("index.table.operation.affirmDelete"),"confirm-button-text":e(b)("index.table.operation.affirm"),"cancel-button-text":e(b)("index.table.operation.cancel"),onConfirm:oe=>O(L.row)},{reference:t(()=>[l(Pe,{style:{"margin-left":"10px"},underline:!1,type:"danger"},{default:t(()=>[k(v(e(b)("index.table.operation.delete")),1)]),_:1})]),_:2},1032,["title","confirm-button-text","cancel-button-text","onConfirm"])]),_:1},8,["label"])]),_:1},8,["header-row-style","header-cell-style","row-style","cell-style","data"])]),_:1},8,["style"])]),_:1},8,["xl","lg","md"]),e(m).enableLabel?(g(),E(We,{key:0,xl:{span:4},lg:{span:5},md:{span:5},class:"hidden-sm-and-down",style:{"padding-left":"15px"}},{default:t(()=>[l(ht,{ref_key:"labelTreeRef",ref:o,onLabelCheckChange:dt,onLabelTreeChange:it},null,512)]),_:1})):N("",!0)]),_:1}),l(Pt,{ref_key:"passwordFormRef",ref:M,labelTree:e(s),onAddPassword:U,onUpdatePassword:p},null,8,["labelTree"]),l(xt,{ref_key:"mainPasswordVerifyRef",ref:_,onVerifyPass:Y},null,512),l(St,{ref_key:"mainPasswordSettingRef",ref:f,onMainPasswordChange:F},null,512),l(Ct,{ref_key:"systemSettingRef",ref:S,onUpdateMainPassword:Ee,onSystemChangeChange:Fe},null,512),l(Vt,{ref_key:"importExportRef",ref:V,labelTree:e(s),onImportComplete:ft},null,8,["labelTree"])],64)}}},na=at(Ll,[["__scopeId","data-v-e1acb462"]]);export{na as default};
