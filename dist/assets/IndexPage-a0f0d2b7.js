import{E as Re}from"./exceljs-6b62d6db.js";import{F as Oe}from"./file-saver-38a5c18e.js";import{h as _e}from"./moment-fbc5633a.js";import{u as oe}from"./vue-i18n-3a91c5c4.js";import{E as te,a as Ie,b as ce,c as pe,d as Pe,e as Tt,f as Mt,g as xe,h as Ke,i as Ne,j as ze,k as Xe,l as Et,m as Se,n as Ft,o as Ze,p as Ce,q as qe,r as $e,s as Dt,t as Rt,u as Qe,v as Ut,w as At,x as Lt,y as It,z as Nt,A as zt,B as $t,C as Gt,D as Bt,F as Yt,G as Wt}from"./element-plus-96c47ee5.js";import{r as T,o as g,c as W,X as q,b as et,u as e,O as N,I as E,ad as Ve,J as t,a as $,S as l,P as k,Q as h,A as ie,R as J,ac as Z,ak as tt,w as je,_ as lt,ar as Ot,as as jt}from"./@vue-2150b1fb.js";import{m as Ht}from"./js-md5-11f5a111.js";import{h as Te}from"./@vueuse-1138cc68.js";import{d as ue,s as Q,g as ve,a as He,l as Ae,b as Ue,u as Jt,c as me,e as ye,f as Le,r as Kt,_ as at,p as st,h as ot,i as Xt}from"./index-3325b649.js";import{u as Zt}from"./vue-router-67d91bd0.js";import{_ as qt}from"./backImg-a3b16eec.js";import{m as Qt,u as el,n as Je,o as tl,v as ll,h as al,r as sl}from"./@element-plus-82a6dcc3.js";import"./ali-oss-21f5c855.js";import"./@intlify-9ddbe450.js";import"./lodash-es-f5bdeb48.js";import"./async-validator-dee29e8b.js";import"./@ctrl-f8748455.js";import"./@popperjs-c75af06c.js";import"./escape-html-cf2a8097.js";import"./normalize-wheel-es-ed76fb12.js";import"./crypto-js-d55471a7.js";import"./vuex-406a410d.js";import"./cos-js-sdk-v5-31c61e27.js";const ol={__name:"ImportExport",emits:["importComplete"],setup(X,{expose:b,emit:H}){const{t:P}=oe(),M=H,n=T(),y=T(),f=T(0),S=c=>{n.value.click(),y.value=c},V=async()=>{if(n.value.files===0)return;f.value=Date.now();const c=new Re.Workbook;c.xlsx.load(n.value.files[0]).then(()=>{c.eachSheet(function(d){if(d.rowCount<2){te.error(P("importExport.data.empty")),n.value.value="";return}let s=[];for(let r=2;r<=d.rowCount;r++){let a=d.getRow(r),x=o(a.getCell(1).value),D=o(a.getCell(2).value),p=o(a.getCell(3).value),C=o(a.getCell(4).value),A=o(a.getCell(5).value),R=o(a.getCell(6).value),O=o(a.getCell(7).value),Y=o(a.getCell(8).value);x&&s.push({id:f.value++,name:x,address:D,userName:p,password:C,remark:R,label:m(A),insertTime:O,updateTime:Y})}M("importComplete",s,y.value),n.value.value=""})}).catch(d=>{te.error(d),n.value.value=""})},o=c=>c?typeof c=="object"?c instanceof Date?_e(c).format("YYYY-MM-DD HH:mm:ss"):c.text:c.toString():"",m=c=>{if(!c)return"";let d=[],s=c.split("、");for(let r=0;r<s.length;r++){let a=_(y.value,s[r],"");if(a)d.push(a);else{let x=[];U(y.value,s[r].split(">"),0,x);for(let D=0;D<x.length;D++)d.push(x[D])}}return Array.from(new Set(d))},_=(c,d,s)=>{for(let r=0;r<c.length;r++){let a=s?s+">"+c[r].label:c[r].label;if(d===a)return c[r].id;if(c[r].children&&c[r].children.length>0)return _(c[r].children,d,a)}},U=(c,d,s,r)=>{if(!d[s])return;for(let x=0;x<c.length;x++)if(c[x].label===d[s])return d[s+1]||r.push(c[x].id),U(c[x].children,d,s+1,r);let a={id:f.value++,label:d[s],children:[]};c.push(a),d[s+1]||r.push(a.id),U(a.children,d,s+1,r)},I=async(c,d)=>{y.value=d;const s=new Re.Workbook,r=s.addWorksheet("sheet1");r.getCell("A1").value=P("password.name"),r.getCell("B1").value=P("password.address"),r.getCell("C1").value=P("password.userName"),r.getCell("D1").value=P("password.password"),r.getCell("E1").value=P("password.label"),r.getCell("F1").value=P("password.remark"),r.getCell("G1").value=P("password.insertTime"),r.getCell("H1").value=P("password.updateTime");for(let a=0;a<c.length;a++){let x=c[a].insertTime;x||(x=_e().format("YYYY-MM-DD HH:mm:ss")),r.getCell("A"+(a+2)).value=c[a].name,r.getCell("B"+(a+2)).value=c[a].address,r.getCell("C"+(a+2)).value=c[a].userName,r.getCell("D"+(a+2)).value=c[a].password,r.getCell("E"+(a+2)).value=B(c[a].label),r.getCell("F"+(a+2)).value=c[a].remark,r.getCell("G"+(a+2)).value=x,r.getCell("H"+(a+2)).value=c[a].updateTime}s.xlsx.writeBuffer().then(a=>{let x=new Blob([a],{type:"application/octet-stream"});Oe.saveAs(x,P("importExport.exportName")+"_"+_e().format("YYYY-MM-DD HH:mm:ss")+".xlsx")})},B=c=>{if(!c)return"";let d=[];return G(y.value,c,d,""),d.join("、")},G=(c,d,s,r)=>{for(let a=0;a<c.length;a++){let x=r?r+">"+c[a].label:c[a].label;d.includes(c[a].id)&&s.push(x),c[a].children&&c[a].children.length>0&&G(c[a].children,d,s,x)}};return b({importExcel:S,exportExcel:I,downloadExcelTemplate:()=>{const c=new Re.Workbook,d=c.addWorksheet("sheet1");d.getCell("A1").value=P("password.name"),d.getCell("B1").value=P("password.address"),d.getCell("C1").value=P("password.userName"),d.getCell("D1").value=P("password.password"),d.getCell("E1").value=P("password.label"),d.getCell("F1").value=P("password.remark"),d.getCell("G1").value=P("password.insertTime"),d.getCell("H1").value=P("password.updateTime"),c.xlsx.writeBuffer().then(s=>{let r=new Blob([s],{type:"application/octet-stream"});Oe.saveAs(r,P("importExport.importTemplateName")+".xlsx")})}}),(c,d)=>(g(),W("input",{type:"file",onChange:V,accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ref_key:"fileUploadInput",ref:n,style:{display:"none"}},null,544))}},nl=["width","height"],Ge={__name:"GesturePassword",props:{size:{type:Number,default:300},count:{type:Number,default:3},showGesture:{type:Boolean,default:!0}},emits:["complete"],setup(X,{expose:b,emit:H}){const P=Te(),M=H,n=T();let y=X;const f=q({padding:y.size*.18,background:P.value?"rgb(20,20,20)":"#fff",failColor:"#F56C6C",passColor:"#67C23A",point:{color:"#409EFF",size:y.size*.023,selected:{range:y.size*.07,color:"#409EFF",size:y.size*.023,madding:{color:"#409EFF",size:y.size*.07,lineWidth:1}}},line:{color:"#409EFF",width:2}}),S=T({}),V=T([]),o=T(!1),m=T("");let _=null;const U=()=>{f.background=P.value?"rgb(20,20,20)":"#fff",_=n.value.getContext("2d"),I()},I=()=>{_.fillStyle=f.background,_.fillRect(0,0,y.size,y.size),S.value=[];let p=(y.size-f.padding*2)/(y.count-1),C=1;for(let A=0;A<y.count;A++)for(let R=0;R<y.count;R++){let O=f.padding+R*p,Y=f.padding+A*p,F=p/2,K={id:C,x:O,y:Y,startX:O-F,endX:O+F,startY:Y-F,endY:Y+F,h:p,w:p};B(K),S.value[C]=K,C++}},B=p=>{let C=a(p);C&&y.showGesture&&(_.beginPath(),m.value==="fail"?_.strokeStyle=f.failColor:m.value==="pass"?_.strokeStyle=f.passColor:_.strokeStyle=f.point.selected.madding.color,_.lineWidth=f.point.selected.madding.lineWidth,_.arc(p.x,p.y,f.point.selected.madding.size,0,Math.PI*2),_.stroke()),_.beginPath(),C&&y.showGesture?(m.value==="fail"?_.fillStyle=f.failColor:m.value==="pass"?_.fillStyle=f.passColor:_.fillStyle=f.point.selected.madding.color,_.arc(p.x,p.y,f.point.selected.size,0,Math.PI*2)):(_.fillStyle=f.point.color,_.arc(p.x,p.y,f.point.size,0,Math.PI*2)),_.fill()},G=()=>{o.value=!0},v=()=>{if(!o.value)return;o.value=!1;let p=d();if(p){let C=Ht(p);M("complete",C)}I(),r()},c=p=>{m.value=p,I(),r(),p?setTimeout(()=>{m.value="",V.value=[],I()},500):(V.value=[],I())},d=()=>{let p="";for(let C=0;C<V.value.length;C++)p+=V.value[C].id+",";return p&&(p=p.substring(0,p.length-1)),p},s=p=>{let C=p.offsetX,A=p.offsetY;if(I(),r(C,A),!o.value)return;let R=x(C,A);!R||a(R)||(V.value.push(R),I(),r(C,A))},r=(p,C)=>{if(!y.showGesture)return;let A=x(p,C);if(A&&m.value===""&&(_.beginPath(),_.strokeStyle=f.point.selected.madding.color,_.lineWidth=f.point.selected.madding.lineWidth,_.arc(A.x,A.y,f.point.selected.madding.size,0,Math.PI*2),_.stroke()),V.value.length!==0){_.beginPath(),m.value==="fail"?_.strokeStyle=f.failColor:m.value==="pass"?_.strokeStyle=f.passColor:_.strokeStyle=f.line.color,_.lineWidth=f.line.width,_.lineCap="round",_.moveTo(V.value[0].x,V.value[0].y);for(let R=1;R<V.value.length;R++)_.lineTo(V.value[R].x,V.value[R].y);o.value&&p&&C&&m.value===""&&_.lineTo(p,C),_.stroke()}},a=p=>{for(let C=0;C<V.value.length;C++)if(p.id===V.value[C].id)return!0;return!1},x=(p,C)=>{for(let A in S.value){let R=S.value[A];if(p>R.startX+f.point.selected.range&&p<R.endX-f.point.selected.range&&C>R.startY+f.point.selected.range&&C<R.endY-f.point.selected.range)return R}},D=p=>{let C=p.touches[0].clientX-n.value.offsetLeft,A=p.touches[0].clientY-n.value.offsetTop;s({offsetX:C,offsetY:A})};return et(()=>{U()}),b({setVerifyStatus:c}),(p,C)=>e(y).size?(g(),W("canvas",{key:0,width:e(y).size,height:e(y).size,ref_key:"canvasRef",ref:n,onMousedown:G,onMouseup:v,onMousemove:C[0]||(C[0]=A=>s(A)),onMouseleave:v,onTouchstart:G,onTouchend:v,onTouchmove:D},null,40,nl)):N("",!0)}},rl={style:{"text-align":"center"}},dl={class:"dialog-footer"},il={__name:"DeleteAccount",emits:["deleteAccount"],setup(X,{expose:b,emit:H}){const{t:P}=oe(),M=H,n=T(),y=q({deleteAccount:!1}),f=T(""),S=T(""),V=()=>{let U=ue(S.value,Q.state.verifyCode);if(U&&U==="password-x"){f.value==="gesture"&&n.value.setVerifyStatus("pass");let I=localStorage.getItem("databaseForm"),B=ue(ve(),I);if(JSON.parse(B).keyId==="LTAI5tRPBc5sY6KbZd1Vc1jU"){te.error("演示账号不能注销");return}He("password.json"),He("labelTree.json"),localStorage.removeItem("systemConfig"),te.success(P("systemSetting.deleteAccount.success")),M("deleteAccount")}else f.value==="common"?te.error(P("systemSetting.deleteAccount.mainPasswordError")):n.value.setVerifyStatus("fail")},o=()=>{f.value=Q.state.mainPasswordType,y.deleteAccount=!0},m=U=>{S.value=U,V()},_=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){_.value=document.documentElement.clientWidth<728}),b({showDeleteAccount:o}),(U,I)=>{const B=Ie,G=Ge,v=ce,c=pe,d=Pe;return g(),E(d,{fullscreen:e(_),modelValue:e(y).deleteAccount,"onUpdate:modelValue":I[1]||(I[1]=s=>e(y).deleteAccount=s),title:e(P)("systemSetting.deleteAccount"),width:"400px"},Ve({default:t(()=>[l(B,{type:"error",closable:!1},{default:t(()=>[k(h(e(P)("systemSetting.deleteAccount.text")),1)]),_:1}),$("div",rl,[e(f)==="gesture"?(g(),E(G,{key:0,ref_key:"gesturePasswordRef",ref:n,onComplete:m},null,512)):N("",!0),e(f)==="common"?(g(),E(v,{key:1,modelValue:e(S),"onUpdate:modelValue":I[0]||(I[0]=s=>ie(S)?S.value=s:null),style:{"margin-top":"20px"}},null,8,["modelValue"])):N("",!0)])]),_:2},[e(f)==="common"?{name:"footer",fn:t(()=>[$("span",dl,[l(c,{type:"danger",onClick:V},{default:t(()=>[k(h(e(P)("systemSetting.deleteAccount.affirm")),1)]),_:1})])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"])}}},ul={style:{"text-align":"center"}},ml={class:"dialog-footer"},cl={__name:"SystemSetting",emits:["updateMainPassword","deleteAccount","systemChangeChange"],setup(X,{expose:b,emit:H}){const P=Zt(),M=Te(),{t:n,locale:y}=oe(),f=H,S=T(),V=q({setting:!1}),o=q(Ae()),m=q({languages:[],sorts:[],topics:[],cacheMains:[],showAddTimes:[],showUpTimes:[],showLabels:[],enableLabels:[],verifyShowGestures:[],cacheDatabaseForms:[],autoGeneratePasswords:[],showPasswordStrengths:[]}),_=()=>{m.languages=[{key:"zh-cn",label:"简体中文"},{key:"en-us",label:"English"}],m.sorts=[{key:"insertTimeDesc",label:n("systemSetting.sort.insertTimeDesc")},{key:"insertTimeAsc",label:n("systemSetting.sort.insertTimeAsc")},{key:"updateTimeDesc",label:n("systemSetting.sort.updateTimeDesc")},{key:"updateTimeAsc",label:n("systemSetting.sort.updateTimeAsc")},{key:"nameAsc",label:n("systemSetting.sort.nameAsc")},{key:"nameDesc",label:n("systemSetting.sort.nameDesc")},{key:"strengthDesc",label:n("systemSetting.sort.strengthAsc")},{key:"strengthAsc",label:n("systemSetting.sort.strengthDesc")}],m.topics=[{key:!1,label:n("systemSetting.topic.light")},{key:!0,label:n("systemSetting.topic.dark")}],m.cacheMains=[{key:!0,label:n("systemSetting.cacheMainPassword.enable")},{key:!1,label:n("systemSetting.cacheMainPassword.disabled")}],m.showAddTimes=[{key:!0,label:n("systemSetting.showAddTime.enable")},{key:!1,label:n("systemSetting.showAddTime.disabled")}],m.showUpTimes=[{key:!0,label:n("systemSetting.showUpTime.enable")},{key:!1,label:n("systemSetting.showUpTime.disabled")}],m.showLabels=[{key:!0,label:n("systemSetting.showLabel.enable")},{key:!1,label:n("systemSetting.showLabel.disabled")}],m.enableLabels=[{key:!0,label:n("systemSetting.enableLabel.enable")},{key:!1,label:n("systemSetting.enableLabel.disabled")}],m.verifyShowGestures=[{key:!0,label:n("mainPasswordSetting.verify.showGesture.enable")},{key:!1,label:n("mainPasswordSetting.verify.showGesture.disabled")}],m.cacheDatabaseForms=[{key:!0,label:n("systemSetting.cacheDatabaseForm.enable")},{key:!1,label:n("systemSetting.cacheDatabaseForm.disabled")}],m.autoGeneratePasswords=[{key:!0,label:n("passwordForm.autoGeneratePassword.enable")},{key:!1,label:n("passwordForm.autoGeneratePassword.disabled")}],m.showPasswordStrengths=[{key:!0,label:n("systemSetting.showPasswordStrength.enable")},{key:!1,label:n("systemSetting.showPasswordStrength.disabled")}]};let U=null;const I=()=>{_();let r=Ae();for(let a in r)o[a]=r[a];U=JSON.stringify(o),V.setting=!0},B=()=>{V.setting=!1},G=()=>{let r=o.defaultPasswordRule;if(!r.number&&!r.symbol&&!r.lowercase&&!r.uppercase){te.error(n("systemSetting.passwordRuleVerify"));return}Jt(o);let a=JSON.parse(U);o.cacheMainPassword!==a.cacheMainPassword&&o.cacheMainPassword===!1&&(localStorage.removeItem("mainPasswordCiphertext"),console.log("删除主密码缓存")),o.cacheDatabaseForm!==a.cacheDatabaseForm&&o.cacheDatabaseForm===!1&&(localStorage.removeItem("databaseForm"),console.log("删除自动登录信息")),o.language!==y.value&&(y.value=o.language,console.log("系统语言设置为：",o.language)),M.value!==o.darkMode&&(M.value=o.darkMode,console.log("暗黑模式设置为：",o.darkMode)),o.sortRule!==a.sortRule&&(f("systemChangeChange","sortChange",o.sortRule),console.log("排序规则设置为：",o.sortRule)),o.showPasswordStrength!==a.showPasswordStrength&&(f("systemChangeChange","showPasswordStrength",o.showPasswordStrength),console.log("是否显示密码强度设置为：",o.showPasswordStrength)),V.setting=!1},v=()=>{localStorage.removeItem("databaseForm"),localStorage.removeItem("mainPasswordCiphertext"),Q.commit("delDatabase"),Q.commit("delDatabaseForm"),Q.commit("delVerifyCode"),P.push("/login")},c=()=>{V.setting=!1,f("updateMainPassword")},d=()=>{V.setting=!1,S.value.showDeleteAccount()},s=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){s.value=document.documentElement.clientWidth<728}),b({logout:v,openSystemSetting:I,showUpdateMainPassword:c,settingForm:o}),(r,a)=>{const x=Tt,D=Mt,p=xe,C=Ke,A=Ne,R=ce,O=ze,Y=Xe,F=pe,K=Et,Me=Se,Ee=Ft,Fe=Ze,ae=Ce,fe=Ie,we=Pe,le=il;return g(),W(J,null,[l(we,{fullscreen:e(s),modelValue:e(V).setting,"onUpdate:modelValue":a[17]||(a[17]=i=>e(V).setting=i),title:e(n)("systemSetting.title"),width:"600px"},{footer:t(()=>[$("span",ml,[l(F,{plain:"",onClick:B},{default:t(()=>[k(h(e(n)("systemSetting.close")),1)]),_:1}),l(F,{type:"primary",plain:"",onClick:G},{default:t(()=>[k(h(e(n)("systemSetting.save")),1)]),_:1})])]),default:t(()=>[l(ae,{"label-width":"150px"},{default:t(()=>[l(Fe,{"tab-position":"left",style:{height:"350px"}},{default:t(()=>[l(Y,{label:e(n)("systemSetting.type.general")},{default:t(()=>[l(p,{label:e(n)("systemSetting.language")},{default:t(()=>[l(D,{modelValue:e(o).language,"onUpdate:modelValue":a[0]||(a[0]=i=>e(o).language=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).languages,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.sort")},{default:t(()=>[l(D,{modelValue:e(o).sortRule,"onUpdate:modelValue":a[1]||(a[1]=i=>e(o).sortRule=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).sorts,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("passwordForm.autoGeneratePassword")},{default:t(()=>[l(D,{modelValue:e(o).autoGeneratePassword,"onUpdate:modelValue":a[2]||(a[2]=i=>e(o).autoGeneratePassword=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).autoGeneratePasswords,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.defaultPasswordRule")},{default:t(()=>[l(O,{style:{"margin-top":"15px"}},{default:t(()=>[l(A,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.uppercase,"onUpdate:modelValue":a[3]||(a[3]=i=>e(o).defaultPasswordRule.uppercase=i),label:e(n)("passwordForm.generateForm.uppercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(A,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.lowercase,"onUpdate:modelValue":a[4]||(a[4]=i=>e(o).defaultPasswordRule.lowercase=i),label:e(n)("passwordForm.generateForm.lowercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(A,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.number,"onUpdate:modelValue":a[5]||(a[5]=i=>e(o).defaultPasswordRule.number=i),label:e(n)("passwordForm.generateForm.number"),border:""},null,8,["modelValue","label"])]),_:1}),l(A,{span:12},{default:t(()=>[l(C,{size:"small",modelValue:e(o).defaultPasswordRule.symbol,"onUpdate:modelValue":a[6]||(a[6]=i=>e(o).defaultPasswordRule.symbol=i),label:e(n)("passwordForm.generateForm.symbol"),border:""},null,8,["modelValue","label"])]),_:1}),l(A,{span:16},{default:t(()=>[$("div",null,[l(R,{size:"small",style:{position:"relative",top:"3px"},modelValue:e(o).defaultPasswordRule.length,"onUpdate:modelValue":a[7]||(a[7]=i=>e(o).defaultPasswordRule.length=i)},{prepend:t(()=>[k(h(e(n)("passwordForm.generateForm.length")),1)]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1},8,["label"])]),_:1},8,["label"]),l(Y,{label:e(n)("systemSetting.type.personalization")},{default:t(()=>[l(p,{label:e(n)("systemSetting.topic")},{default:t(()=>[l(D,{modelValue:e(o).darkMode,"onUpdate:modelValue":a[8]||(a[8]=i=>e(o).darkMode=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).topics,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showPasswordStrength")},{default:t(()=>[l(D,{modelValue:e(o).showPasswordStrength,"onUpdate:modelValue":a[9]||(a[9]=i=>e(o).showPasswordStrength=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).showPasswordStrengths,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showAddTime")},{default:t(()=>[l(D,{modelValue:e(o).showAddTime,"onUpdate:modelValue":a[10]||(a[10]=i=>e(o).showAddTime=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).showAddTimes,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showUpTime")},{default:t(()=>[l(D,{modelValue:e(o).showUpTime,"onUpdate:modelValue":a[11]||(a[11]=i=>e(o).showUpTime=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).showUpTimes,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.enableLabel")},{default:t(()=>[l(D,{modelValue:e(o).enableLabel,"onUpdate:modelValue":a[12]||(a[12]=i=>e(o).enableLabel=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).enableLabels,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.showLabel")},{default:t(()=>[l(D,{disabled:!e(o).enableLabel,modelValue:e(o).showLabel,"onUpdate:modelValue":a[13]||(a[13]=i=>e(o).showLabel=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).showLabels,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),l(Y,{label:e(n)("systemSetting.type.security")},{default:t(()=>[l(p,{label:e(n)("systemSetting.cacheMainPassword")},{default:t(()=>[l(D,{modelValue:e(o).cacheMainPassword,"onUpdate:modelValue":a[14]||(a[14]=i=>e(o).cacheMainPassword=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).cacheMains,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("systemSetting.cacheDatabaseForm")},{default:t(()=>[l(D,{modelValue:e(o).cacheDatabaseForm,"onUpdate:modelValue":a[15]||(a[15]=i=>e(o).cacheDatabaseForm=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).cacheDatabaseForms,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(p,{label:e(n)("mainPasswordSetting.verify.showGesture")},{default:t(()=>[l(D,{modelValue:e(o).verifyShowGesture,"onUpdate:modelValue":a[16]||(a[16]=i=>e(o).verifyShowGesture=i)},{default:t(()=>[(g(!0),W(J,null,Z(e(m).verifyShowGestures,i=>(g(),E(x,{key:i.key,label:i.label,value:i.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["label"]),l(Y,{label:e(n)("systemSetting.type.other")},{default:t(()=>[$("div",ul,[l(F,{plain:"",onClick:c},{default:t(()=>[k(h(e(n)("systemSetting.updateMainPassword")),1)]),_:1}),l(F,{plain:"",type:"danger",onClick:d},{default:t(()=>[k(h(e(n)("systemSetting.deleteAccount")),1)]),_:1}),l(F,{type:"warning",plain:"",onClick:v},{default:t(()=>[k(h(e(n)("systemSetting.logout")),1)]),_:1})])]),_:1},8,["label"]),l(Y,{label:e(n)("systemSetting.about"),style:{"text-align":"center"}},{default:t(()=>[l(Ee,{column:1,style:{margin:"15px"}},{default:t(()=>[l(K,null,{label:t(()=>[k(h(e(n)("systemSetting.about.version"))+": ",1)]),default:t(()=>[k(" "+h(e(Ue)("VITE_VERSION")),1)]),_:1}),l(K,null,{label:t(()=>[k(h(e(n)("systemSetting.about.openSourceUrl"))+": ",1)]),default:t(()=>[l(Me,{target:"_blank",href:e(Ue)("VITE_OPEN_SOURCE_URL")},{default:t(()=>[k(h(e(Ue)("VITE_OPEN_SOURCE_URL")),1)]),_:1},8,["href"])]),_:1}),l(K,null,{default:t(()=>[k(h(e(n)("systemSetting.about.submit")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),_:1}),l(fe,{style:{"margin-top":"20px"},type:"warning"},{default:t(()=>[k(h(e(n)("systemSetting.takeEffect")),1)]),_:1})]),_:1},8,["fullscreen","modelValue","title"]),l(le,{ref_key:"deleteAccountRef",ref:S,onDeleteAccount:v},null,512)],64)}}},pl={style:{"text-align":"center"}},fl={class:"dialog-footer"},nt={__name:"MainPasswordVerify",emits:["verifyPass"],setup(X,{expose:b,emit:H}){const{t:P}=oe(),M=H,n=T(),y=T(""),f=T(""),S=q({verifyMainPassword:!1}),V=v=>{y.value=v,o()},o=()=>{let v=ue(y.value,Q.state.verifyCode);v&&v==="password-x"?(f.value==="gesture"&&n.value.setVerifyStatus("pass"),M("verifyPass",y.value),_(y.value),y.value="",S.verifyMainPassword=!1):f.value==="common"?te.error(P("mainPasswordVerify.form.verify")):n.value.setVerifyStatus("fail")},m=()=>{localStorage.removeItem("mainPasswordCiphertext")},_=v=>{if(me("cacheMainPassword")===!1)return;let d=ve(),s=ye(d,v);localStorage.setItem("mainPasswordCiphertext",s)},U=()=>{if(me("cacheMainPassword")===!1)return null;let c=localStorage.getItem("mainPasswordCiphertext");if(!c)return null;let d=ve(),s=ue(d,c);return s||null},I=()=>me("verifyShowGesture")!==!1,B=(v=!0)=>{if(f.value=Q.state.mainPasswordType,!v){S.verifyMainPassword=!0;return}let c=U();if(!c){S.verifyMainPassword=!0;return}let d=ue(c,Q.state.verifyCode);d&&d==="password-x"?M("verifyPass",c):S.verifyMainPassword=!0},G=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){G.value=document.documentElement.clientWidth<728}),b({verifyMainPassword:B,delLocalMainPassword:m}),(v,c)=>{const d=Ge,s=ce,r=xe,a=Ce,x=pe,D=Pe;return g(),E(D,{fullscreen:e(G),modelValue:e(S).verifyMainPassword,"onUpdate:modelValue":c[1]||(c[1]=p=>e(S).verifyMainPassword=p),title:e(P)("mainPasswordVerify.form.title"),width:"400px"},Ve({default:t(()=>[$("div",pl,[e(f)==="gesture"&&e(S).verifyMainPassword?(g(),E(d,{key:0,"show-gesture":I(),ref_key:"gesturePasswordRef",ref:n,onComplete:V},null,8,["show-gesture"])):N("",!0),e(f)==="common"&&e(S).verifyMainPassword?(g(),E(a,{key:1,style:{padding:"10px"}},{default:t(()=>[l(r,null,{default:t(()=>[l(s,{modelValue:e(y),"onUpdate:modelValue":c[0]||(c[0]=p=>ie(y)?y.value=p:null),placeholder:e(P)("mainPasswordVerify.form.mainPassword"),type:"password",onKeyup:tt(o,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1})]),_:1})):N("",!0)])]),_:2},[e(f)==="common"?{name:"footer",fn:t(()=>[$("span",fl,[l(x,{type:"primary",disabled:!e(y),onClick:o},{default:t(()=>[k(h(e(P)("mainPasswordVerify.form.save")),1)]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"])}}},wl={class:"dialog-footer"},gl={__name:"MainPasswordSetting",emits:["mainPasswordChange"],setup(X,{expose:b,emit:H}){const{t:P}=oe(),M=H,n=T(),y=T(),f=T("gesture"),S=T(""),V=T(""),o=q({mainPassword:!1}),m=T(""),_=c=>{m.value==="setting"?(S.value=c,m.value="affirm",y.value.setVerifyStatus("")):m.value==="affirm"&&(V.value=c,U())},U=()=>{if(S.value!==V.value){te.error(P("mainPasswordSetting.form.passwordsDiff"));return}let c=localStorage.getItem("databaseForm"),d=ue(ve(),c);if(JSON.parse(d).accessKeyId==="LTAI5tRPBc5sY6KbZd1Vc1jU"){te.error("演示账号不能修改主密码");return}f.value==="gesture"?Q.commit("setMainPasswordType","gesture"):Q.commit("setMainPasswordType","common"),M("mainPasswordChange",S.value,f.value);let r=me("cacheMainPassword");if(r||r==null){let a=ve(),x=ye(a,S.value);localStorage.setItem("mainPasswordCiphertext",x)}S.value="",V.value="",o.mainPassword=!1},I=()=>{m.value="setting",o.mainPassword=!0},B=()=>{n.value.verifyMainPassword(!1)},G=()=>{f.value==="gesture"&&(m.value="setting"),S.value="",V.value=""},v=T(document.documentElement.clientWidth<728);return window.addEventListener("resize",function(){v.value=document.documentElement.clientWidth<728}),b({settingMainPassword:I,updateMainPassword:B}),(c,d)=>{const s=Ie,r=qe,a=Ge,x=Se,D=Xe,p=ce,C=xe,A=Ce,R=Ze,O=pe,Y=Pe,F=nt;return g(),W(J,null,[l(Y,{fullscreen:e(v),modelValue:e(o).mainPassword,"onUpdate:modelValue":d[4]||(d[4]=K=>e(o).mainPassword=K),title:e(P)("mainPasswordSetting.form.setMainPassword"),width:"470px"},Ve({default:t(()=>[l(s,{type:"error",style:{position:"relative",top:"-10px"},closable:!1},{default:t(()=>[k(h(e(P)("mainPasswordSetting.forget.message")),1)]),_:1}),l(R,{modelValue:e(f),"onUpdate:modelValue":d[3]||(d[3]=K=>ie(f)?f.value=K:null),style:{"margin-top":"10px"},type:"card",onTabChange:G},{default:t(()=>[l(D,{label:e(P)("mainPasswordSetting.passwordType.gesture"),name:"gesture",style:{"text-align":"center"}},{default:t(()=>[$("div",null,[e(m)==="setting"?(g(),E(r,{key:0},{default:t(()=>[k(h(e(P)("mainPasswordSetting.gesture.first")),1)]),_:1})):N("",!0),e(m)==="affirm"?(g(),E(r,{key:1},{default:t(()=>[k(h(e(P)("mainPasswordSetting.gesture.affirm")),1)]),_:1})):N("",!0)]),e(o).mainPassword&&e(f)==="gesture"?(g(),E(a,{key:0,ref_key:"gesturePasswordRef",ref:y,onComplete:_},null,512)):N("",!0),$("div",null,[l(x,{underline:!1,style:{position:"relative",top:"-2px"},type:"primary",onClick:d[0]||(d[0]=K=>m.value="setting")},{default:t(()=>[k(h(e(P)("mainPasswordSetting.gesture.reset")),1)]),_:1})])]),_:1},8,["label"]),l(D,{label:e(P)("mainPasswordSetting.passwordType.common"),name:"common",style:{"text-align":"center"}},{default:t(()=>[l(A,{inline:!0,"label-width":"100px",style:{"margin-top":"20px"}},{default:t(()=>[l(C,{label:e(P)("mainPasswordSetting.form.newMainPassword")},{default:t(()=>[l(p,{type:"password",modelValue:e(S),"onUpdate:modelValue":d[1]||(d[1]=K=>ie(S)?S.value=K:null),style:{width:"231px"}},null,8,["modelValue"])]),_:1},8,["label"]),l(C,{label:e(P)("mainPasswordSetting.form.newMainPasswordAffirm")},{default:t(()=>[l(p,{type:"password",modelValue:e(V),"onUpdate:modelValue":d[2]||(d[2]=K=>ie(V)?V.value=K:null),style:{width:"231px"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:2},[e(f)==="common"?{name:"footer",fn:t(()=>[$("span",wl,[l(O,{type:"primary",disabled:!e(S),onClick:U},{default:t(()=>[k(h(e(P)("mainPasswordSetting.form.save")),1)]),_:1},8,["disabled"])])]),key:"0"}:void 0]),1032,["fullscreen","modelValue","title"]),l(F,{ref_key:"mainPasswordVerifyRef",ref:n,onVerifyPass:I},null,512)],64)}}},bl={class:"dialog-footer"},_l={__name:"PasswordForm",props:{labelTree:Array},emits:["addPassword","updatePassword"],setup(X,{expose:b,emit:H}){const P=H,{t:M}=oe(),n=T(),y=q({password:!1}),f=T(""),S=q({uppercase:"ABCDEFGHJKLMNPQRSTUVWXYZ",lowercase:"abcdefghjkmnpqrstuvwxyz",number:"0123456789",symbol:"~!@#$^&*()_+.,;"}),V=()=>({id:0,name:"",address:"",userName:"",password:"",remark:"",label:"",insertTime:"",updateTime:""}),o=q(V()),m=q({length:16,number:!0,lowercase:!0,uppercase:!0,symbol:!0}),_=q({name:[{required:!0,message:M("passwordForm.form.name.verify"),trigger:"blur"}]}),U=()=>{if(!m.number&&!m.symbol&&!m.lowercase&&!m.uppercase){te.error(M("systemSetting.passwordRuleVerify"));return}let d=[];m.lowercase&&d.push(S.lowercase),m.uppercase&&d.push(S.uppercase),m.symbol&&d.push(S.symbol),m.number&&d.push(S.number),o.password=Kt(d,m.length)},I=async d=>{await d.validate(s=>{s&&(y.password=!1,f.value==="add"?(o.id=Date.now(),o.insertTime=_e().format("YYYY-MM-DD HH:mm:ss"),P("addPassword",JSON.parse(JSON.stringify(o)))):(o.updateTime=_e().format("YYYY-MM-DD HH:mm:ss"),P("updatePassword",JSON.parse(JSON.stringify(o)))))})},B=()=>{let d=me("defaultPasswordRule");if(d)for(let s in d)m[s]=d[s]},G=()=>{B();let d=V();for(let r in d)o[r]=d[r];me("autoGeneratePassword")&&U(),f.value="add",y.password=!0},v=d=>{B();for(let s in o)o[s]=d[s];f.value="update",y.password=!0},c=()=>document.documentElement.clientWidth;return b({showAddPassword:G,showUpdatePassword:v}),(d,s)=>{const r=ce,a=xe,x=pe,D=Ne,p=ze,C=Ke,A=$e,R=Dt,O=Ce,Y=Rt;return g(),E(Y,{modelValue:e(y).password,"onUpdate:modelValue":s[13]||(s[13]=F=>e(y).password=F),title:e(f)==="add"?e(M)("passwordForm.form.addPassword"):e(M)("passwordForm.form.editPassword"),size:"620px",direction:c()>768?"rtl":"btt"},{footer:t(()=>[$("span",bl,[l(x,{onClick:s[12]||(s[12]=F=>I(e(n))),type:"primary"},{default:t(()=>[k(h(e(M)("passwordForm.generateForm.save")),1)]),_:1})])]),default:t(()=>[l(O,{ref_key:"passwordFormRef",ref:n,model:e(o),rules:e(_),"label-width":"70px",style:{"padding-right":"30px"}},{default:t(()=>[l(a,{label:e(M)("password.name"),prop:"name"},{default:t(()=>[l(r,{modelValue:e(o).name,"onUpdate:modelValue":s[0]||(s[0]=F=>e(o).name=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.address")},{default:t(()=>[l(r,{modelValue:e(o).address,"onUpdate:modelValue":s[1]||(s[1]=F=>e(o).address=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.userName")},{default:t(()=>[l(r,{modelValue:e(o).userName,"onUpdate:modelValue":s[2]||(s[2]=F=>e(o).userName=F),clearable:""},null,8,["modelValue"])]),_:1},8,["label"]),l(a,{label:e(M)("password.password")},{default:t(()=>[l(A,{style:{width:"100%"}},{default:t(()=>[l(p,null,{default:t(()=>[l(D,null,{default:t(()=>[l(r,{modelValue:e(o).password,"onUpdate:modelValue":s[4]||(s[4]=F=>e(o).password=F),clearable:""},{append:t(()=>[l(x,{onClick:s[3]||(s[3]=F=>e(Le)(e(o).password))},{default:t(()=>[k(h(e(M)("passwordForm.generateForm.password.copy")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p,{style:{"margin-top":"15px"}},{default:t(()=>[l(D,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(m).uppercase,"onUpdate:modelValue":s[5]||(s[5]=F=>e(m).uppercase=F),label:e(M)("passwordForm.generateForm.uppercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(D,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(m).lowercase,"onUpdate:modelValue":s[6]||(s[6]=F=>e(m).lowercase=F),label:e(M)("passwordForm.generateForm.lowercase"),border:""},null,8,["modelValue","label"])]),_:1}),l(D,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(m).number,"onUpdate:modelValue":s[7]||(s[7]=F=>e(m).number=F),label:e(M)("passwordForm.generateForm.number"),border:""},null,8,["modelValue","label"])]),_:1}),l(D,{xs:{span:12},md:{span:6},style:{"text-align":"center"}},{default:t(()=>[l(C,{size:"small",modelValue:e(m).symbol,"onUpdate:modelValue":s[8]||(s[8]=F=>e(m).symbol=F),label:e(M)("passwordForm.generateForm.symbol"),border:""},null,8,["modelValue","label"])]),_:1})]),_:1}),l(p,{style:{"margin-top":"15px"}},{default:t(()=>[l(D,{style:{"text-align":"center"}},{default:t(()=>[l(r,{modelValue:e(m).length,"onUpdate:modelValue":s[9]||(s[9]=F=>e(m).length=F),size:"small",style:{width:"120px"}},{prepend:t(()=>[k(h(e(M)("passwordForm.generateForm.length")),1)]),_:1},8,["modelValue"]),l(x,{plain:"",size:"small",style:{position:"relative",top:"-5px","margin-left":"10px"},type:"success",onClick:U},{default:t(()=>[k(h(e(M)("passwordForm.generateForm.randomPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["label"]),e(me)("enableLabel")!==!1?(g(),E(a,{key:0,label:e(M)("password.label")},{default:t(()=>[l(R,{modelValue:e(o).label,"onUpdate:modelValue":s[10]||(s[10]=F=>e(o).label=F),"value-key":"id",data:X.labelTree,"check-strictly":"",multiple:"","default-expand-all":"",placeholder:e(M)("password.label.placeholder"),filterable:""},null,8,["modelValue","data","placeholder"])]),_:1},8,["label"])):N("",!0),l(a,{label:e(M)("password.remark")},{default:t(()=>[l(r,{type:"textarea",placeholder:e(M)("passwordForm.generateForm.remark"),rows:4,modelValue:e(o).remark,"onUpdate:modelValue":s[11]||(s[11]=F=>e(o).remark=F)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","direction"])}}};const yl={class:"label-tree-node"},vl=["onClick","onBlur"],hl={class:"label-tree-node-menu"},kl={__name:"LabelTree",emits:["labelCheckChange","labelTreeChange"],setup(X,{expose:b,emit:H}){const P=Te(),{t:M}=oe(),n=H,y=T(),f=T([]),S=T([]),V=T(!1),o=()=>{let s=y.value.getCheckedNodes();n("labelCheckChange",s)},m=(s,r)=>s?r.label.includes(s):!0,_=s=>{const r={id:Date.now(),label:M("labelTree.addLabel"),children:[]};s.children||(s.children=[]),s.children.push(r)},U=(s,r)=>{const a=s.parent,x=a.data.children||a.data,D=x.findIndex(p=>p.id===r.id);x.splice(D,1)},I=s=>!s.edit,B=()=>{S.value.push({id:Date.now(),label:M("labelTree.firstAddLabel"),children:[]})},G=()=>{V.value&&st("labelTree.json",{labelTree:S.value})},v=s=>{S.value=s};je(f,s=>{y.value.filter(s)}),je(S,()=>{G(),n("labelTreeChange",S.value)},{deep:!0});const c=()=>{ot("labelTree.json").then(s=>{s&&s.labelTree?S.value=s.labelTree:S.value=[],V.value=!0}).catch(s=>{Qe.error(s.code)})},d=()=>P.value;return c(),b({setLabelTree:v}),(s,r)=>{const a=ce,x=pe,D=Se,p=Ut,C=At,A=$e;return g(),E(A,{class:"body-card",style:lt({"background-color":d()?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.4)"})},{header:t(()=>[k(h(e(M)("labelTree.title")),1)]),default:t(()=>[l(a,{modelValue:e(f),"onUpdate:modelValue":r[0]||(r[0]=R=>ie(f)?f.value=R:null),clearable:"",placeholder:e(M)("labelTree.search.placeholder")},null,8,["modelValue","placeholder"]),l(C,{height:"50vh"},{default:t(()=>[l(p,{data:e(S),"show-checkbox":"",ref_key:"labelTreeRef",ref:y,draggable:"","node-key":"id",style:{"margin-top":"10px","background-color":"rgba(0,0,0,0)"},onCheck:o,"filter-node-method":m,"expand-on-click-node":!1,"allow-drag":I,"default-expand-all":""},{empty:t(()=>[l(x,{size:"small",type:"primary",plain:"",onClick:B},{default:t(()=>[k(h(e(M)("labelTree.firstAddLabel")),1)]),_:1})]),default:t(({node:R,data:O})=>[$("span",yl,[R.edit?N("",!0):(g(),W("span",{key:0,onClick:Y=>R.edit=!0,onBlur:Y=>R.edit=!1},h(O.label),41,vl)),R.edit?(g(),E(a,{key:1,style:{width:"60%"},ref:R.id+"_input",size:"small",onBlur:Y=>R.edit=!1,modelValue:O.label,"onUpdate:modelValue":Y=>O.label=Y},null,8,["onBlur","modelValue","onUpdate:modelValue"])):N("",!0),$("span",hl,[l(D,{onClick:Y=>_(O),type:"primary",underline:!1},{default:t(()=>[k(h(e(M)("labelTree.tree.add")),1)]),_:2},1032,["onClick"]),l(D,{onClick:Y=>U(R,O),type:"danger",underline:!1,style:{"margin-left":"8px"}},{default:t(()=>[k(h(e(M)("labelTree.tree.remove")),1)]),_:2},1032,["onClick"])])])]),_:1},8,["data"])]),_:1})]),_:1},8,["style"])}}},Pl=at(kl,[["__scopeId","data-v-5b83f236"]]);const he=X=>(Ot("data-v-b77ab475"),X=X(),jt(),X),xl=he(()=>$("img",{alt:"",class:"back-img",src:qt},null,-1)),Sl={style:{display:"flex","justify-content":"space-between"}},Cl={class:"hidden-xs-only"},Vl=he(()=>$("br",null,null,-1)),Tl={key:1},Ml={style:{display:"flex","justify-content":"end"},class:"password-title-right"},El=he(()=>$("div",{class:"password-strength",style:{"background-color":"#67C23A"}},null,-1)),Fl=he(()=>$("div",{class:"password-strength",style:{"background-color":"#E6A23C"}},null,-1)),Dl=he(()=>$("div",{class:"password-strength",style:{"background-color":"#F56C6C"}},null,-1)),Rl={key:0},Ul={class:"password-text"},Al={class:"pass-action-div"},Ll={__name:"IndexPage",setup(X){const{t:b,locale:H}=oe(),P=Te(),M=T(),n=T(),y=T(),f=T(),S=T(),V=T(),o=T(),m=q({}),_=T(""),U=T(""),I=T(""),B=T(!1),G=T(""),v=T([]),c=T([]),d=T([]),s=T([]),r=async()=>{if(!_.value&&!d.value){c.value=v.value;return}let u=[];for(let w=0;w<v.value.length;w++){let z=v.value[w].name||"",j=v.value[w].userName||"",ne=v.value[w].address||"",re=v.value[w].remark||"",de=v.value[w].password||"",De=!_.value||z.includes(_.value)||j.includes(_.value)||ne.includes(_.value)||re.includes(_.value)||de.includes(_.value),ge=!1;if(d.value.length>0)for(let be=0;be<d.value.length;be++){let ee=d.value[be];v.value[w].label&&v.value[w].label.includes(ee.id)&&(ge=!0)}else ge=!0;De&&ge&&u.push(v.value[w])}c.value=u},a=()=>{M.value.showAddPassword()},x=u=>{M.value.showUpdatePassword(u)},D=u=>{v.value.unshift(u),i(),r()},p=u=>{for(let w=0;w<v.value.length;w++)if(v.value[w].id===u.id){v.value[w]=u,i(),r();break}},C=()=>{G.value=ye(U.value,JSON.stringify(v.value)),B.value=!1,c.value=[],v.value=[],U.value="",y.value.delLocalMainPassword()},A=()=>{y.value.verifyMainPassword()},R=u=>{let w=b("password.name")+": "+u.name+`\r
`;u.address&&(w+=b("password.address")+": "+u.address+`\r
`),u.userName&&(w+=b("password.userName")+": "+u.userName+`\r
`),u.password&&(w+=b("password.password")+": "+u.password+`\r
`),u.remark&&(w+=u.remark+`\r
`),w=w.substring(0,w.length-2),Le(w)},O=u=>{for(let w=0;w<v.value.length;w++)if(v.value[w].id===u.id){v.value.splice(w,1),i(),r(),te.success(b("index.table.delete.success"));break}},Y=u=>{U.value=u;let w=ue(u,G.value);v.value=JSON.parse(w),B.value=!0,r()},F=(u,w)=>{U.value=u,I.value=w,i(),te.success(b("index.mainPassword.changeSuccess"))},K=()=>{S.value.openSystemSetting()},Me=()=>{f.value.updateMainPassword()},Ee=(u,w)=>{m[u]=w,u==="sortChange"&&Fe(w)},Fe=u=>{u==="insertTimeDesc"?(n.value.sort("insertTime","descending"),le("insertTime",-1)):u==="insertTimeAsc"?(n.value.sort("insertTime","ascending"),le("insertTime",1)):u==="updateTimeDesc"?(n.value.sort("updateTime","descending"),le("updateTime",-1)):u==="updateTimeAsc"?(n.value.sort("updateTime","ascending"),le("updateTime",1)):u==="nameAsc"?(n.value.sort("name","ascending"),le("name",1)):u==="nameDesc"?(n.value.sort("name","descending"),le("name",-1)):u==="strengthDesc"?(n.value.sort("strength","descending"),le("strength",-1)):u==="strengthAsc"&&(n.value.sort("strength","ascending"),le("strength",1)),i()},ae=u=>{let w=0;return/[0-9]/.test(u)&&w++,/[a-z]/.test(u)&&w++,/[A-Z]/.test(u)&&w++,/[^0-9a-zA-Z_]/.test(u)&&w++,u.length<6&&w>2&&(w=2),w>3?3:w},fe=(u,w)=>ae(u.password)>ae(w.password)?1:-1,we=u=>{let w=0;for(let z=0;z<v.value.length;z++){if(!v.value[z].password)continue;let j=ae(v.value[z].password);u===j&&w++}return w},le=(u,w)=>{v.value.sort((z,j)=>u==="strength"?w>0?fe(z,j):fe(j,z):(z=z[u],j=j[u],z<j?w*-1:z>j?w*1:0))},i=()=>{if(!B.value)return;G.value=ye(U.value,JSON.stringify(v.value));let u=ye(U.value,"password-x");Q.commit("setVerifyCode",u),st("password.json",{verifyValue:u,mainPasswordType:I.value,passwordCiphertext:G.value})},rt=()=>{ot("password.json").then(u=>{if(u.verifyValue){let w=u.verifyValue;I.value=u.mainPasswordType||"common",Q.commit("setVerifyCode",w),Q.commit("setMainPasswordType",I.value),G.value=u.passwordCiphertext,y.value.verifyMainPassword(!0)}else B.value=!0,f.value.settingMainPassword()}).catch(u=>{console.error(u),Qe.error("error-1000："+u)})},dt=u=>{d.value=u,r()},it=u=>{s.value=u},ut=u=>{if(!u)return"";let w=[];return Ye(s.value,u,w),w},Be=u=>u&&u.length===19?u.substring(0,16):u,Ye=(u,w,z)=>{for(let j=0;j<u.length;j++)w.includes(u[j].id)&&z.push(u[j].label),u[j].children&&u[j].children.length>0&&Ye(u[j].children,w,z)},mt=()=>{V.value.downloadExcelTemplate()},ct=()=>{V.value.importExcel(s.value)},pt=()=>{V.value.exportExcel(v.value,s.value)},ft=(u,w)=>{if(u.length!==0){for(let z=u.length-1;z>=0;z--)v.value.unshift(u[z]);o.value.setLabelTree(w),i(),r()}},wt=()=>{S.value.logout()},gt=()=>P.value;return et(()=>{let u=Ae();for(let w in u)m[w]=u[w];m.language&&m.language!==H.value&&(H.value=m.language),rt()}),(u,w)=>{const z=qe,j=ce,ne=pe,re=Lt,de=It,De=Nt,ge=zt,be=$t,ee=Gt,ke=Se,bt=Wt,_t=Bt,yt=Yt,vt=$e,We=Ne,ht=Pl,kt=ze,Pt=_l,xt=nt,St=gl,Ct=cl,Vt=ol;return g(),W(J,null,[xl,l(kt,{id:"passwordBody"},{default:t(()=>[l(We,{xl:{span:e(m).enableLabel?16:20,offset:2},lg:{span:e(m).enableLabel?19:24},md:{span:e(m).enableLabel?19:24}},{default:t(()=>[l(vt,{class:"body-card",style:lt({"background-color":gt()?"rgba(0,0,0,0.4)":"rgba(255,255,255,0.4)"})},{header:t(()=>[$("div",Sl,[$("div",null,[$("div",Cl,[e(v)?(g(),E(z,{key:0,class:"password-table-title"},{default:t(()=>[k(h(e(v).length)+" "+h(e(b)("index.title.passwordCount")),1)]),_:1})):N("",!0),Vl,e(m).showPasswordStrength?(g(),W("div",Tl,[l(z,{class:"password-table-strength"},{default:t(()=>[k(h(e(b)("index.title.strength"))+"（ ",1),l(z,{type:"success"},{default:t(()=>[k(h(e(b)("index.title.strength.strong")),1)]),_:1}),k(" : "+h(we(3))+" ",1),l(z,{style:{"margin-left":"5px"},type:"warning"},{default:t(()=>[k(h(e(b)("index.title.strength.medium")),1)]),_:1}),k(" : "+h(we(2))+" ",1),l(z,{style:{"margin-left":"5px"},type:"danger"},{default:t(()=>[k(h(e(b)("index.title.strength.weak")),1)]),_:1}),k(" : "+h(we(1))+"） ",1)]),_:1})])):N("",!0)])]),$("div",Ml,[$("div",null,[l(j,{modelValue:e(_),"onUpdate:modelValue":w[0]||(w[0]=L=>ie(_)?_.value=L:null),style:{"max-width":"300px"},clearable:"",placeholder:e(b)("index.title.search"),"prefix-icon":e(Qt),disabled:!e(U),onKeyup:tt(r,["enter"])},null,8,["modelValue","placeholder","prefix-icon","disabled","onKeyup"])]),$("div",null,[l(ne,{disabled:!e(U)||!e(B),type:"primary",plain:"",onClick:w[1]||(w[1]=L=>a())},{default:t(()=>[k(h(e(b)("index.title.addPassword")),1)]),_:1},8,["disabled"])]),$("div",null,[e(U)?N("",!0):(g(),E(re,{key:0,content:e(b)("index.title.unlock"),effect:"dark",placement:"top"},{default:t(()=>[l(ne,{disabled:!e(G),icon:e(el),onClick:A},null,8,["disabled","icon"])]),_:1},8,["content"])),e(U)?(g(),E(re,{key:1,content:e(b)("index.title.lock"),effect:"dark",placement:"top"},{default:t(()=>[l(ne,{icon:e(Je),onClick:C},null,8,["icon"])]),_:1},8,["content"])):N("",!0)]),l(ge,null,{dropdown:t(()=>[l(De,null,{default:t(()=>[l(de,{onClick:K},{default:t(()=>[k(h(e(b)("systemSetting.title")),1)]),_:1}),l(de,{divided:"",onClick:ct},{default:t(()=>[k(h(e(b)("index.title.importExport.import")),1)]),_:1}),l(de,{onClick:pt},{default:t(()=>[k(h(e(b)("index.title.importExport.export")),1)]),_:1}),l(de,{onClick:mt},{default:t(()=>[k(h(e(b)("index.title.importExport.download")),1)]),_:1}),l(de,{divided:"",onClick:wt},{default:t(()=>[k(h(e(b)("index.title.logout")),1)]),_:1})]),_:1})]),default:t(()=>[l(ne,{icon:e(tl)},null,8,["icon"])]),_:1})])])]),default:t(()=>[l(yt,{height:"calc(100vh - 130px)",style:{"background-color":"rgba(0,0,0,0)"},"header-row-style":{"background-color":"rgba(0,0,0,0)"},"header-cell-style":{"background-color":"rgba(0,0,0,0)"},"row-style":{"background-color":"rgba(0,0,0,0)"},"cell-style":{"background-color":"rgba(0,0,0,0)"},data:e(c),ref_key:"tableRef",ref:n},{empty:t(()=>[l(be,{description:e(U)?e(b)("index.table.empty"):e(b)("index.table.lock")},Ve({default:t(()=>[l(ne,{onClick:A,plain:"",type:"primary"},{default:t(()=>[k(h(e(b)("index.title.unlock")),1)]),_:1})]),_:2},[e(U)?void 0:{name:"image",fn:t(()=>[l(e(Je))]),key:"0"}]),1032,["description"])]),default:t(()=>[e(m).showPasswordStrength?(g(),E(ee,{key:0,sortable:"","sort-method":fe,prop:"strength",width:"30px"},{default:t(L=>[ae(L.row.password)===3?(g(),E(re,{key:0},{content:t(()=>[k(h(e(b)("index.title.strength")+"："+e(b)("index.title.strength.strong")),1)]),default:t(()=>[El]),_:1})):N("",!0),ae(L.row.password)===2?(g(),E(re,{key:1},{content:t(()=>[k(h(e(b)("index.title.strength")+"："+e(b)("index.title.strength.medium")),1)]),default:t(()=>[Fl]),_:1})):N("",!0),ae(L.row.password)===1?(g(),E(re,{key:2},{content:t(()=>[k(h(e(b)("index.title.strength")+"："+e(b)("index.title.strength.weak")),1)]),default:t(()=>[Dl]),_:1})):N("",!0)]),_:1})):N("",!0),l(ee,{sortable:"",label:e(b)("password.name"),"min-width":"130px",prop:"name"},null,8,["label"]),l(ee,{label:e(b)("password.address"),"min-width":"200px",prop:"address"},{default:t(L=>[e(Xt)(L.row.address)?(g(),E(ke,{key:0,href:L.row.address,target:"_blank"},{default:t(()=>[k(h(L.row.address),1)]),_:2},1032,["href"])):(g(),E(z,{key:1},{default:t(()=>[k(h(L.row.address),1)]),_:2},1024))]),_:1},8,["label"]),l(ee,{label:e(b)("password.userName"),"min-width":"140px",prop:"userName"},null,8,["label"]),l(ee,{label:e(b)("password.password"),"min-width":"180px",prop:"password"},{default:t(L=>[L.row.password?(g(),W("div",Rl,[$("span",Ul,[L.row.show?N("",!0):(g(),W(J,{key:0},[k("•••••••••")],64)),L.row.show?(g(),W(J,{key:1},[k(h(L.row.password),1)],64)):N("",!0)]),$("div",Al,[L.row.show?N("",!0):(g(),E(e(ll),{key:0,onClick:se=>L.row.show=!L.row.show},null,8,["onClick"])),L.row.show?(g(),E(e(al),{key:1,onClick:se=>L.row.show=!L.row.show},null,8,["onClick"])):N("",!0),l(e(sl),{onClick:se=>e(Le)(L.row.password)},null,8,["onClick"])])])):N("",!0)]),_:1},8,["label"]),e(m).enableLabel!==!1&&e(m).showLabel!==!1?(g(),E(ee,{key:1,label:e(b)("index.table.label"),"min-width":"130px",prop:"label"},{default:t(L=>[(g(!0),W(J,null,Z(ut(L.row.label),se=>(g(),E(bt,{style:{margin:"3px"},key:se},{default:t(()=>[k(h(se),1)]),_:2},1024))),128))]),_:1},8,["label"])):N("",!0),l(ee,{label:e(b)("password.remark"),"min-width":"130px",prop:"remark"},null,8,["label"]),e(m).showAddTime?(g(),E(ee,{key:2,sortable:"",label:e(b)("password.insertTime"),width:"145px",prop:"insertTime"},{default:t(L=>[k(h(Be(L.row.insertTime)),1)]),_:1},8,["label"])):N("",!0),e(m).showUpTime?(g(),E(ee,{key:3,sortable:"",label:e(b)("password.updateTime"),width:"145px",prop:"updateTime"},{default:t(L=>[k(h(Be(L.row.updateTime)),1)]),_:1},8,["label"])):N("",!0),l(ee,{width:"135px",label:e(b)("index.table.operation")},{default:t(L=>[l(ke,{type:"success",underline:!1,onClick:se=>R(L.row)},{default:t(()=>[k(h(e(b)("index.table.share")),1)]),_:2},1032,["onClick"]),l(ke,{underline:!1,style:{"margin-left":"10px"},type:"primary",onClick:se=>x(L.row)},{default:t(()=>[k(h(e(b)("index.table.edit")),1)]),_:2},1032,["onClick"]),l(_t,{title:e(b)("index.table.operation.affirmDelete"),"confirm-button-text":e(b)("index.table.operation.affirm"),"cancel-button-text":e(b)("index.table.operation.cancel"),onConfirm:se=>O(L.row)},{reference:t(()=>[l(ke,{style:{"margin-left":"10px"},underline:!1,type:"danger"},{default:t(()=>[k(h(e(b)("index.table.operation.delete")),1)]),_:1})]),_:2},1032,["title","confirm-button-text","cancel-button-text","onConfirm"])]),_:1},8,["label"])]),_:1},8,["header-row-style","header-cell-style","row-style","cell-style","data"])]),_:1},8,["style"])]),_:1},8,["xl","lg","md"]),e(m).enableLabel?(g(),E(We,{key:0,xl:{span:4},lg:{span:5},md:{span:5},class:"hidden-sm-and-down",style:{"padding-left":"15px"}},{default:t(()=>[l(ht,{ref_key:"labelTreeRef",ref:o,onLabelCheckChange:dt,onLabelTreeChange:it},null,512)]),_:1})):N("",!0)]),_:1}),l(Pt,{ref_key:"passwordFormRef",ref:M,labelTree:e(s),onAddPassword:D,onUpdatePassword:p},null,8,["labelTree"]),l(xt,{ref_key:"mainPasswordVerifyRef",ref:y,onVerifyPass:Y},null,512),l(St,{ref_key:"mainPasswordSettingRef",ref:f,onMainPasswordChange:F},null,512),l(Ct,{ref_key:"systemSettingRef",ref:S,onUpdateMainPassword:Me,onSystemChangeChange:Ee},null,512),l(Vt,{ref_key:"importExportRef",ref:V,labelTree:e(s),onImportComplete:ft},null,8,["labelTree"])],64)}}},na=at(Ll,[["__scopeId","data-v-b77ab475"]]);export{na as default};
